<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>DialUp CRM</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
:root {
  --coral:#FF6B6B; --peach:#FF8E53; --light:#FFA07A;
  --teal:#00C9A7; --teal2:#00A88A;
  --blue:#1A73E8; --blue2:#0D5BC4;
  --purple:#8B5CF6; --purple2:#7C3AED;
  --red:#FF4757; --green:#00C896; --green2:#00A87C;
  --amber:#FFB830;
  --dark:#1C1C2E; --mid:#5A3A2E;
  --warm:#FFFAF8; --softgray:#F5F5F7;
  --border:#E8E8EC;
  --card-shadow:0 8px 32px rgba(200,70,40,.15);
  --r:20px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;font-family:'Nunito',sans-serif;background:linear-gradient(150deg,var(--coral) 0%,var(--peach) 50%,var(--light) 100%)}

/* blobs */
body::before{content:'';position:fixed;width:340px;height:340px;background:rgba(255,255,255,.07);border-radius:50%;top:-100px;right:-80px;pointer-events:none;z-index:0}
body::after{content:'';position:fixed;width:240px;height:240px;background:rgba(255,255,255,.05);border-radius:50%;bottom:40px;left:-70px;pointer-events:none;z-index:0}

/* SCREENS */
.screen{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;z-index:1;transition:opacity .3s,transform .3s}
.screen.hidden{display:none!important}

/* â•â•â•â•â•â•â•â•â•â•â• TOP BAR â•â•â•â•â•â•â•â•â•â•â• */
.top-bar{width:100%;display:flex;justify-content:space-between;align-items:center;padding:52px 18px 10px;flex-shrink:0;gap:8px}
.pill{display:inline-flex;align-items:center;gap:5px;background:rgba(255,255,255,.22);border:1.5px solid rgba(255,255,255,.4);border-radius:30px;padding:6px 13px;font-size:12px;font-weight:800;color:#fff;cursor:pointer;backdrop-filter:blur(8px);transition:transform .15s;white-space:nowrap}
.pill:active{transform:scale(.91)}
.pill.hot-active{background:rgba(255,71,87,.35);border-color:rgba(255,71,87,.6)}
.pts-lbl{font-size:12px;font-weight:800;color:rgba(255,255,255,.9);white-space:nowrap}
.icon-btn{width:37px;height:37px;flex-shrink:0;border-radius:50%;background:rgba(255,255,255,.22);border:1.5px solid rgba(255,255,255,.4);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:17px;color:#fff;backdrop-filter:blur(8px);transition:all .15s}
.icon-btn:active{transform:scale(.9)}

/* â•â•â•â•â•â•â•â•â•â•â• CARD ZONE â•â•â•â•â•â•â•â•â•â•â• */
.card-zone{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;padding:0 18px 80px;gap:0}

/* NUDGE BANNER */
.nudge-banner{width:100%;max-width:360px;background:rgba(255,255,255,.2);border:1.5px solid rgba(255,255,255,.35);border-radius:14px;padding:10px 14px;margin-bottom:10px;backdrop-filter:blur(8px);display:none}
.nudge-top{font-size:11px;font-weight:800;color:#fff;letter-spacing:.5px;margin-bottom:3px}
.nudge-stat{font-size:12px;font-weight:700;color:rgba(255,255,255,.85);line-height:1.4}

/* LEAD CARD */
.lead-card{background:rgba(255,255,255,.93);border-radius:var(--r);padding:20px 20px 16px;width:100%;max-width:360px;box-shadow:var(--card-shadow);user-select:none;transition:transform .15s;position:relative;overflow:hidden;cursor:pointer}
.lead-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--card-accent,var(--coral)),var(--card-accent,var(--peach)))}
.lead-card.dragging{box-shadow:0 24px 60px rgba(200,70,40,.28)}
.card-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.type-chip{background:linear-gradient(135deg,var(--coral),var(--peach));color:#fff;font-size:10px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;padding:4px 11px;border-radius:30px}
.days-chip{display:flex;align-items:center;gap:4px;border-radius:20px;padding:4px 10px;font-size:11px;font-weight:700}
.days-chip.fresh{background:#F0FFF8;border:1px solid #B3FFE0;color:var(--green2)}
.days-chip.warm{background:#FFF8F0;border:1px solid #FFD5A0;color:#C07000}
.days-chip.urgent{background:#FFF0F0;border:1px solid #FFB3B3;color:var(--red)}
.lead-name{font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:1px;color:var(--dark);line-height:1;margin-bottom:3px}
.lead-source{font-size:12px;font-weight:700;color:var(--mid);opacity:.7;margin-bottom:8px}
.lead-note{font-size:13px;font-weight:600;color:var(--dark);line-height:1.5;background:#FFF7F5;border-radius:10px;padding:9px 12px;border-left:3px solid var(--coral)}
.card-footer{display:flex;justify-content:space-between;align-items:center;margin-top:9px}
.call-badge{font-size:11px;font-weight:700;color:var(--mid);opacity:.7}
.prio-dot{width:8px;height:8px;border-radius:50%}
.prio-dot.hot{background:var(--red)} .prio-dot.warm{background:var(--peach)} .prio-dot.cold{background:#74B9FF}

.swipe-row{display:flex;justify-content:space-between;padding:7px 4px 0;width:100%;max-width:360px}
.swipe-lbl{font-size:11px;font-weight:700;color:rgba(255,255,255,.5)}

/* ACTION BUTTONS */
.action-row{display:flex;gap:10px;margin-top:10px;width:100%;max-width:360px}
.act-btn{flex:1;border:none;border-radius:16px;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:16px 8px;-webkit-user-select:none;transition:transform .12s}
.act-btn:active{transform:scale(.95)}
.call-btn-main{background:linear-gradient(145deg,var(--green),var(--green2));box-shadow:0 6px 18px rgba(0,168,124,.35)}
.text-btn-main{background:linear-gradient(145deg,var(--purple),var(--purple2));box-shadow:0 6px 18px rgba(124,58,237,.32)}
@keyframes callPulse{0%,100%{box-shadow:0 6px 18px rgba(0,168,124,.35),0 0 0 0 rgba(0,200,150,.4)}50%{box-shadow:0 6px 18px rgba(0,168,124,.35),0 0 0 16px rgba(0,200,150,0)}}
.call-btn-main{animation:callPulse 2.4s ease-in-out infinite}
.btn-icon{font-size:24px;line-height:1}
.btn-lbl{font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:1.5px;color:#fff}
.btn-sub{font-size:10px;font-weight:800;color:rgba(255,255,255,.72);letter-spacing:.5px}

/* â•â•â•â•â•â•â•â•â•â•â• DAILY PLAYS â•â•â•â•â•â•â•â•â•â•â• */
#noLeads{display:none;width:100%;padding:0 18px 90px;flex-direction:column;align-items:center}
.plays-header{text-align:center;margin-bottom:16px}
.plays-header h2{font-family:'Bebas Neue',sans-serif;font-size:34px;color:#fff;letter-spacing:1px;line-height:1}
.plays-header p{font-size:13px;font-weight:700;color:rgba(255,255,255,.75);margin-top:4px}
.play-card{background:rgba(255,255,255,.93);border-radius:var(--r);padding:16px 18px;width:100%;max-width:360px;margin-bottom:10px;box-shadow:var(--card-shadow);position:relative;overflow:hidden;cursor:pointer;transition:transform .15s}
.play-card:active{transform:scale(.98)}
.play-card::before{content:'';position:absolute;top:0;left:0;bottom:0;width:4px}
.play-card.play-prospect::before{background:var(--red)}
.play-card.play-intel::before{background:var(--teal)}
.play-card.play-brand::before{background:var(--purple)}
.play-num{font-size:10px;font-weight:800;letter-spacing:2px;text-transform:uppercase;opacity:.5;margin-bottom:4px}
.play-title{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:.5px;color:var(--dark);margin-bottom:4px}
.play-desc{font-size:12px;font-weight:600;color:#666;line-height:1.5}
.play-tag{display:inline-block;font-size:10px;font-weight:800;letter-spacing:1px;text-transform:uppercase;padding:3px 9px;border-radius:20px;margin-top:6px}
.play-card.play-prospect .play-tag{background:rgba(255,71,87,.1);color:var(--red)}
.play-card.play-intel .play-tag{background:rgba(0,201,167,.1);color:var(--teal2)}
.play-card.play-brand .play-tag{background:rgba(139,92,246,.1);color:var(--purple)}
.add-lead-small{background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.4);border-radius:14px;padding:13px 28px;font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:2px;color:#fff;cursor:pointer;backdrop-filter:blur(8px);margin-top:4px;transition:all .15s;width:100%;max-width:360px;text-align:center}
.add-lead-small:active{transform:scale(.96)}

/* â•â•â•â•â•â•â•â•â•â•â• PLAY DETAIL SHEET â•â•â•â•â•â•â•â•â•â•â• */
/* reuse overlay/sheet styles below */

/* â•â•â•â•â•â•â•â•â•â•â• OVERLAYS & SHEETS â•â•â•â•â•â•â•â•â•â•â• */
.overlay{position:absolute;inset:0;background:rgba(20,10,5,.52);backdrop-filter:blur(6px);display:flex;align-items:flex-end;z-index:100;transition:opacity .3s}
.overlay.hidden{opacity:0;pointer-events:none}
.sheet{background:var(--warm);border-radius:28px 28px 0 0;padding:0 0 40px;width:100%;max-height:92vh;overflow-y:auto}
.sheet-handle{width:40px;height:4px;background:rgba(0,0,0,.1);border-radius:4px;margin:14px auto 18px}
.sh{padding:0 20px}
.sheet-title{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:1px;color:var(--dark);margin-bottom:3px}
.sheet-sub{font-size:13px;font-weight:700;color:#999;margin-bottom:16px}

/* outcome */
.oc-row{display:flex;gap:8px;margin-bottom:14px}
.oc-btn{flex:1;padding:12px 5px;border-radius:13px;border:2px solid var(--border);background:var(--softgray);font-size:11px;font-weight:800;color:#777;cursor:pointer;text-align:center;transition:all .18s;display:flex;flex-direction:column;align-items:center;gap:3px}
.oc-btn .oci{font-size:19px}
.oc-btn:active{transform:scale(.95)}
.oc-btn.sel-answered{border-color:var(--green);background:#F0FFF9;color:var(--green2)}
.oc-btn.sel-noanswer{border-color:var(--amber);background:#FFF8F0;color:#C07000}
.oc-btn.sel-voicemail{border-color:var(--blue);background:#F0F5FF;color:var(--blue)}

/* script card */
.script-card{border-radius:15px;padding:13px 15px;margin-bottom:13px;border:1.5px solid}
.script-card.call-type{background:#F8F5FF;border-color:#DDD6FE}
.script-card.text-type{background:#F0FFF9;border-color:#B3FFE0}
.sc-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px}
.sc-tag{font-size:10px;letter-spacing:1.5px;text-transform:uppercase;font-weight:800;color:var(--purple)}
.sc-tag.green{color:var(--green2)}
.copy-btn{background:var(--blue);border:none;border-radius:8px;padding:5px 13px;font-size:11px;font-weight:800;color:#fff;cursor:pointer;font-family:'Nunito',sans-serif;transition:all .15s}
.copy-btn:active{transform:scale(.92)}
.copy-btn.ok{background:var(--green)}
.sc-body{font-size:13px;font-weight:600;color:#333;line-height:1.65;white-space:pre-wrap}

/* notes + mic */
.notes-wrap{position:relative;margin-bottom:13px}
.modal-notes{width:100%;background:var(--softgray);border:1.5px solid var(--border);border-radius:13px;padding:11px 48px 11px 13px;color:var(--dark);font-size:14px;font-family:'Nunito',sans-serif;font-weight:600;resize:none;height:78px;outline:none;transition:border-color .2s}
.modal-notes:focus{border-color:rgba(26,115,232,.4);background:#fff}
.modal-notes::placeholder{color:#C8C8C8;font-weight:600}
.mic-btn{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:30px;height:30px;border-radius:50%;background:var(--blue);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;box-shadow:0 2px 8px rgba(26,115,232,.28);transition:all .15s}
.mic-btn:active{transform:translateY(-50%) scale(.9)}
.mic-btn.rec{background:var(--red);animation:micpulse 1s ease-in-out infinite}
@keyframes micpulse{0%,100%{box-shadow:0 0 0 0 rgba(255,71,87,.5)}50%{box-shadow:0 0 0 8px rgba(255,71,87,0)}}

.save-btn{width:100%;padding:16px;background:linear-gradient(135deg,var(--coral),var(--peach));border:none;border-radius:15px;font-family:'Bebas Neue',sans-serif;font-size:19px;letter-spacing:2px;color:#fff;cursor:pointer;box-shadow:0 4px 14px rgba(200,80,50,.25);transition:all .15s}
.save-btn:active{transform:scale(.97)}
.cancel-btn{width:100%;margin-top:9px;padding:13px;background:transparent;border:1.5px solid var(--border);border-radius:13px;font-family:'Nunito',sans-serif;font-weight:800;font-size:14px;color:#AAA;cursor:pointer}

/* â•â•â•â•â•â•â•â•â•â•â• WEEKLY SUMMARY â•â•â•â•â•â•â•â•â•â•â• */
#summaryOv{position:absolute;inset:0;z-index:200;background:linear-gradient(150deg,var(--coral),var(--peach),var(--light));display:flex;flex-direction:column;align-items:center;justify-content:flex-start;overflow-y:auto;padding:60px 22px 50px;transition:all .4s;gap:0}
#summaryOv.hidden{opacity:0;pointer-events:none;transform:scale(.95)}
.sum-label{font-size:11px;letter-spacing:2.5px;text-transform:uppercase;color:rgba(255,255,255,.65);font-weight:800;margin-bottom:6px}
.sum-week{font-family:'Bebas Neue',sans-serif;font-size:28px;color:#fff;letter-spacing:1px;margin-bottom:20px}
.sum-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;width:100%;max-width:340px;margin-bottom:16px}
.sum-cell{background:rgba(255,255,255,.18);border:1.5px solid rgba(255,255,255,.3);border-radius:16px;padding:14px;text-align:center;backdrop-filter:blur(8px)}
.sum-num{font-family:'Bebas Neue',sans-serif;font-size:44px;color:#fff;line-height:1}
.sum-cell-lbl{font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:rgba(255,255,255,.65);font-weight:800;margin-top:3px}
.sum-streak{background:rgba(255,255,255,.18);border:1.5px solid rgba(255,255,255,.3);border-radius:16px;padding:14px 20px;width:100%;max-width:340px;margin-bottom:16px;text-align:center;backdrop-filter:blur(8px)}
.sum-streak-fire{font-size:36px;margin-bottom:4px}
.sum-streak-txt{font-family:'Bebas Neue',sans-serif;font-size:22px;color:#fff;letter-spacing:1px}
.sum-challenge{background:rgba(255,255,255,.15);border:1.5px solid rgba(255,255,255,.28);border-radius:16px;padding:16px 18px;width:100%;max-width:340px;margin-bottom:14px;backdrop-filter:blur(8px)}
.sum-challenge-lbl{font-size:10px;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,.6);font-weight:800;margin-bottom:6px}
.sum-challenge-txt{font-size:14px;font-weight:700;color:#fff;line-height:1.6}
.sum-quote{background:rgba(255,255,255,.12);border-left:3px solid rgba(255,255,255,.5);border-radius:0 14px 14px 0;padding:14px 16px;width:100%;max-width:340px;margin-bottom:20px}
.sum-quote-txt{font-size:13px;font-weight:700;color:rgba(255,255,255,.9);line-height:1.65;font-style:italic}
.sum-quote-author{font-size:11px;font-weight:800;color:rgba(255,255,255,.55);margin-top:6px;letter-spacing:.5px}
.sum-close{padding:14px 44px;background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.4);border-radius:16px;font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:2px;color:#fff;cursor:pointer;backdrop-filter:blur(8px);transition:all .15s}
.sum-close:active{transform:scale(.96)}

/* â•â•â•â•â•â•â•â•â•â•â• SCORE OVERLAY â•â•â•â•â•â•â•â•â•â•â• */
#scoreOv{position:absolute;inset:0;z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:11px;background:linear-gradient(150deg,var(--coral),var(--peach));transition:all .4s}
#scoreOv.hidden{opacity:0;pointer-events:none;transform:scale(.95)}
.sc-big{font-family:'Bebas Neue',sans-serif;font-size:96px;color:#fff;line-height:1;text-shadow:0 4px 20px rgba(0,0,0,.1)}
.sc-lbl{font-size:11px;letter-spacing:2.5px;text-transform:uppercase;color:rgba(255,255,255,.6);font-weight:800}
.sc-grid{display:flex;gap:28px;margin:6px 0}
.sc-cell{text-align:center}
.sc-num{font-family:'Bebas Neue',sans-serif;font-size:40px;color:#fff;line-height:1}
.sc-cell-lbl{font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:rgba(255,255,255,.55);font-weight:800;margin-top:3px}
.sc-msg{font-size:14px;font-weight:700;color:rgba(255,255,255,.85);text-align:center;max-width:260px;line-height:1.5}

.sc-close{margin-top:6px;padding:13px 44px;background:rgba(255,255,255,.2);border:2px solid rgba(255,255,255,.4);border-radius:16px;font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:2px;color:#fff;cursor:pointer;backdrop-filter:blur(8px)}

/* â•â•â•â•â•â•â•â•â•â•â• ADD LEAD SCREEN â•â•â•â•â•â•â•â•â•â•â• */
#screen-add{background:var(--warm);justify-content:flex-start;overflow-y:auto}
.add-head{width:100%;padding:52px 18px 14px;display:flex;align-items:center;gap:13px;background:linear-gradient(135deg,var(--coral),var(--peach));position:sticky;top:0;z-index:10;flex-shrink:0}
.back-btn{width:35px;height:35px;border-radius:50%;background:rgba(255,255,255,.25);border:1.5px solid rgba(255,255,255,.4);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:17px;color:#fff;transition:all .15s}
.back-btn:active{transform:scale(.9)}
.add-head h2{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:1px;color:#fff}
.add-form{width:100%;max-width:420px;padding:20px 18px 70px;display:flex;flex-direction:column;gap:16px;align-self:center}
.f-lbl{font-size:11px;letter-spacing:1.5px;text-transform:uppercase;color:#999;font-weight:800;margin-bottom:6px;display:block}
.f-in{width:100%;background:var(--softgray);border:1.5px solid var(--border);border-radius:13px;padding:13px 15px;color:var(--dark);font-size:16px;font-family:'Nunito',sans-serif;font-weight:600;outline:none;transition:border-color .2s;-webkit-appearance:none}
.f-in:focus{border-color:rgba(26,115,232,.4);background:#fff}
.f-in::placeholder{color:#C8C8C8}
.tog-row{display:flex;gap:9px}
.tog-opt{flex:1;padding:12px 8px;border-radius:13px;border:2px solid var(--border);background:var(--softgray);text-align:center;font-weight:800;font-size:13px;cursor:pointer;transition:all .2s;color:#888}
.tog-opt.sel{border-color:var(--coral);background:rgba(255,107,107,.07);color:var(--coral)}
.prio-row{display:flex;gap:8px}
.prio-opt{flex:1;padding:10px 5px;border-radius:12px;border:2px solid var(--border);background:var(--softgray);text-align:center;font-size:12px;font-weight:800;cursor:pointer;transition:all .2s;color:#888}
.prio-opt.sel{border-color:var(--coral);background:rgba(255,107,107,.07);color:var(--coral)}
.add-note-wrap{position:relative}
.add-mic{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:30px;height:30px;border-radius:50%;background:var(--blue);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;box-shadow:0 2px 8px rgba(26,115,232,.25);transition:all .15s}
.add-mic:active{transform:translateY(-50%) scale(.9)}
.add-mic.rec{background:var(--red);animation:micpulse 1s ease-in-out infinite}
.save-lead-btn{width:100%;padding:16px;background:linear-gradient(135deg,var(--coral),var(--peach));border:none;border-radius:15px;font-family:'Bebas Neue',sans-serif;font-size:19px;letter-spacing:2px;color:#fff;cursor:pointer;box-shadow:0 4px 14px rgba(200,80,50,.2);transition:all .15s;margin-top:4px}
.save-lead-btn:active{transform:scale(.97)}

/* PROGRESS BAR */
.prog-bar{position:absolute;top:0;left:0;right:0;height:3px;background:rgba(255,255,255,.18);z-index:10}
.prog-fill{height:100%;background:rgba(255,255,255,.7);transition:width .6s}

/* TOAST */
.toast{position:absolute;top:82px;left:50%;transform:translateX(-50%) translateY(-14px);background:rgba(28,28,46,.88);color:#fff;font-weight:800;font-size:13px;padding:9px 20px;border-radius:30px;opacity:0;transition:all .3s;pointer-events:none;white-space:nowrap;z-index:500;backdrop-filter:blur(10px)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â•â•â•â•â•â•â•â•â•â•â• CONTACT DETAIL SCREEN â•â•â•â•â•â•â•â•â•â•â• */
#screen-detail{background:var(--warm);justify-content:flex-start;overflow-y:auto}
.detail-head{width:100%;padding:52px 18px 14px;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(135deg,var(--coral),var(--peach));position:sticky;top:0;z-index:10;flex-shrink:0}
.detail-head h2{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:1px;color:#fff}
.detail-save-btn{background:rgba(255,255,255,.25);border:1.5px solid rgba(255,255,255,.5);border-radius:20px;padding:6px 16px;font-family:'Nunito',sans-serif;font-weight:800;font-size:13px;color:#fff;cursor:pointer;transition:all .15s}
.detail-save-btn:active{transform:scale(.93)}
.detail-body{width:100%;max-width:420px;padding:22px 18px 30px;display:flex;flex-direction:column;gap:0;align-self:center}

/* avatar circle */
.contact-avatar{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--coral),var(--peach));display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:32px;color:#fff;margin:0 auto 6px;box-shadow:0 4px 16px rgba(200,80,50,.28)}
.contact-fullname{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:1px;color:var(--dark);text-align:center;margin-bottom:4px}
.contact-meta{font-size:12px;font-weight:700;color:#AAA;text-align:center;margin-bottom:20px}

/* section groups like iPhone */
.detail-section{margin-bottom:14px}
.detail-section-lbl{font-size:11px;letter-spacing:1.5px;text-transform:uppercase;color:#AAA;font-weight:800;margin-bottom:6px;padding-left:4px}
.detail-group{background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,.06)}
.detail-row{display:flex;align-items:center;padding:13px 16px;border-bottom:1px solid #F0F0F0;gap:12px}
.detail-row:last-child{border-bottom:none}
.detail-row-icon{font-size:18px;width:24px;text-align:center;flex-shrink:0}
.detail-row-content{flex:1;display:flex;flex-direction:column;gap:2px}
.detail-row-lbl{font-size:10px;letter-spacing:1px;text-transform:uppercase;color:#AAA;font-weight:800}
.detail-row-val{font-size:15px;font-weight:600;color:var(--dark)}
.detail-edit-input{width:100%;border:none;outline:none;font-size:15px;font-weight:600;color:var(--dark);font-family:'Nunito',sans-serif;background:transparent;padding:0}
.detail-edit-input::placeholder{color:#C8C8C8}
.detail-edit-ta{width:100%;border:none;outline:none;font-size:14px;font-weight:600;color:var(--dark);font-family:'Nunito',sans-serif;background:transparent;padding:0;resize:none;min-height:60px;line-height:1.5}
.detail-edit-ta::placeholder{color:#C8C8C8}

/* type + prio toggles inside detail */
.detail-tog-row{display:flex;gap:8px;padding:10px 16px}
.detail-tog{flex:1;padding:9px 6px;border-radius:10px;border:1.5px solid var(--border);background:var(--softgray);text-align:center;font-weight:800;font-size:12px;cursor:pointer;transition:all .2s;color:#888}
.detail-tog.sel{border-color:var(--coral);background:rgba(255,107,107,.08);color:var(--coral)}

/* call history */
.history-item{display:flex;align-items:center;gap:10px;padding:11px 16px;border-bottom:1px solid #F0F0F0}
.history-item:last-child{border-bottom:none}
.history-icon{font-size:16px;width:24px;text-align:center}
.history-txt{flex:1}
.history-outcome{font-size:13px;font-weight:700;color:var(--dark)}
.history-date{font-size:11px;color:#AAA;font-weight:600;margin-top:1px}

/* promote to hot */
.promote-btn{width:100%;padding:14px;background:linear-gradient(135deg,#FF4757,#FF6B6B);border:none;border-radius:14px;font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:2px;color:#fff;cursor:pointer;margin-bottom:10px;transition:all .15s;box-shadow:0 4px 14px rgba(255,71,87,.28)}
.promote-btn:active{transform:scale(.97)}

/* delete button iPhone style */
.delete-contact-btn{width:100%;padding:15px;background:#fff;border:none;border-radius:14px;font-family:'Nunito',sans-serif;font-weight:800;font-size:15px;color:#FF4757;cursor:pointer;text-align:center;box-shadow:0 2px 12px rgba(0,0,0,.06);margin-bottom:30px;transition:all .15s}
.delete-contact-btn:active{background:#FFF0F0;transform:scale(.98)}


/* â•â•â•â•â•â•â•â•â•â•â• BOTTOM TAB BAR â•â•â•â•â•â•â•â•â•â•â• */
.tab-bar{
  position:fixed;bottom:0;left:0;right:0;
  background:rgba(255,255,255,.95);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  border-top:1px solid rgba(0,0,0,.08);
  display:flex;align-items:stretch;
  z-index:300;
  padding-bottom:env(safe-area-inset-bottom);
  box-shadow:0 -4px 24px rgba(0,0,0,.08);
}
.tab-item{
  flex:1;display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  padding:10px 4px 8px;cursor:pointer;
  transition:all .18s;gap:3px;
  position:relative;
}
.tab-item:active{transform:scale(.92)}
.tab-icon{font-size:20px;line-height:1;transition:transform .2s}
.tab-label{font-size:10px;font-weight:800;letter-spacing:.5px;color:#BBB;transition:color .18s;text-transform:uppercase}
.tab-item.active .tab-label{color:var(--coral)}
.tab-item.active .tab-icon{transform:scale(1.15)}
.tab-item.active::before{
  content:'';position:absolute;top:0;left:20%;right:20%;
  height:3px;background:var(--coral);border-radius:0 0 4px 4px;
}
#tab-warm.active .tab-label{color:var(--peach)}
#tab-warm.active::before{background:var(--peach)}
#tab-contract.active .tab-label{color:var(--blue)}
#tab-contract.active::before{background:var(--blue)}
#tab-people.active .tab-label{color:var(--amber)}
#tab-people.active::before{background:var(--amber)}
.tab-badge{
  position:absolute;top:6px;right:calc(50% - 18px);
  background:var(--red);color:#fff;
  font-size:9px;font-weight:800;
  min-width:16px;height:16px;border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  padding:0 4px;border:2px solid #fff;
}


/* â•â•â•â•â•â•â•â•â•â•â• MILESTONE TRACKER â•â•â•â•â•â•â•â•â•â•â• */
.milestone-progress-wrap{padding:14px 16px 10px;border-bottom:1px solid #F0F0F0}
.milestone-progress-label{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px}
.milestone-progress-title{font-size:12px;font-weight:800;color:var(--dark);letter-spacing:.3px}
.milestone-progress-pct{font-size:12px;font-weight:800;color:var(--blue)}
.milestone-bar-bg{height:8px;background:#F0F0F0;border-radius:6px;overflow:hidden}
.milestone-bar-fill{height:100%;border-radius:6px;background:linear-gradient(90deg,#1A73E8,#00C9A7);transition:width .4s ease}

.milestone-item{display:flex;align-items:center;padding:11px 16px;border-bottom:1px solid #F0F0F0;gap:12px;cursor:pointer;transition:background .15s}
.milestone-item:last-child{border-bottom:none}
.milestone-item:active{background:#F8F8F8}
.milestone-check{width:24px;height:24px;border-radius:50%;border:2px solid #DDD;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s;font-size:13px}
.milestone-check.done{background:var(--green);border-color:var(--green);color:#fff}
.milestone-check.overdue{border-color:var(--red);background:#FFF0F0}
.milestone-check.soon{border-color:var(--amber);background:#FFFBF0}
.milestone-info{flex:1}
.milestone-name{font-size:13px;font-weight:700;color:var(--dark);margin-bottom:2px}
.milestone-name.done{text-decoration:line-through;color:#AAA}
.milestone-due{font-size:11px;font-weight:700}
.milestone-due.upcoming{color:#AAA}
.milestone-due.soon{color:var(--amber)}
.milestone-due.overdue{color:var(--red)}
.milestone-due.done{color:var(--green)}
.milestone-date-input{font-size:11px;font-weight:700;color:var(--blue);background:transparent;border:none;outline:none;font-family:'Nunito',sans-serif;cursor:pointer;max-width:120px}

/* contract date fields */
.contract-dates-row{display:flex;gap:8px;padding:12px 16px;border-bottom:1px solid #F0F0F0}
.contract-date-field{flex:1;display:flex;flex-direction:column;gap:4px}
.contract-date-lbl{font-size:10px;letter-spacing:1px;text-transform:uppercase;color:#AAA;font-weight:800}
.contract-date-input{border:1.5px solid var(--border);border-radius:10px;padding:8px 10px;font-size:13px;font-weight:700;color:var(--dark);font-family:'Nunito',sans-serif;background:var(--softgray);outline:none;width:100%;transition:border-color .2s}
.contract-date-input:focus{border-color:var(--blue);background:#fff}

/* property address on contract card */
.contract-property{background:linear-gradient(135deg,#EBF3FF,#F0F5FF);border:1.5px solid #C5D9F7;border-radius:14px;padding:13px 15px;margin-bottom:0}
.contract-property-lbl{font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--blue);font-weight:800;margin-bottom:4px}
.contract-property-addr{font-size:15px;font-weight:700;color:var(--dark);line-height:1.4}


/* â•â•â•â•â•â•â•â•â•â•â• DAILY PLAYS â•â•â•â•â•â•â•â•â•â•â• */
.play-item{display:flex;gap:14px;padding:16px;background:var(--softgray);border-radius:14px;margin-bottom:12px;cursor:pointer;transition:all .15s;border:2px solid transparent}
.play-item:active{background:#E8F5E9;border-color:var(--green)}
.play-check{width:28px;height:28px;border-radius:50%;border:2.5px solid #DDD;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;transition:all .2s}
.play-check.done{background:var(--green);border-color:var(--green)}
.play-content{flex:1}
.play-title{font-size:14px;font-weight:800;color:var(--dark);margin-bottom:4px}
.play-desc{font-size:12px;color:#666;line-height:1.5;margin-bottom:6px}
.play-pts{font-size:11px;font-weight:800;color:var(--green);letter-spacing:.5px}
.close-x{position:absolute;top:18px;right:18px;width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,.06);display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:#666;cursor:pointer;transition:all .15s;z-index:10}
.close-x:active{background:rgba(0,0,0,.12);transform:scale(.92)}
</style>
</head>
<body>

<div class="prog-bar"><div class="prog-fill" id="progFill" style="width:0%"></div></div>
<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-main">
  <div class="top-bar">
    <div class="pill" id="streakPill" onclick="showScore()">ğŸ”¥ <span id="streakNum">0</span>d</div>
    <div style="flex:1"></div>
    <div class="icon-btn" onclick="openPlays()">ğŸ’¡</div>
    <div class="icon-btn" onclick="showSummary()">ğŸ“Š</div>
    <div class="icon-btn" onclick="goAdd()">ï¼‹</div>
  </div>

  <!-- LEAD CARD -->
  <div class="card-zone" id="cardZone">
    <div style="width:100%;max-width:360px">
      <!-- NUDGE BANNER -->
      <div class="nudge-banner" id="nudgeBanner">
        <div class="nudge-top" id="nudgeTop">ğŸ‘‹ Hey â€” it's been a while</div>
        <div class="nudge-stat" id="nudgeStat"></div>
      </div>
      <div class="lead-card" id="leadCard" onclick="handleCardTap(event)">
        <div class="card-top">
          <div class="type-chip" id="lcType">ğŸ’° SELLER</div>
          <div class="days-chip fresh" id="lcDays">ğŸ• New</div>
        </div>
        <div class="lead-name" id="lcName" style="cursor:pointer">LISA JOHNSON</div>
        <div class="lead-source" id="lcSource">Expired Â· (559) 555-0100</div>
        <div class="lead-note" id="lcNote" style="cursor:pointer">Needs to sell in 60 days â€” divorce situation</div>
        <div class="card-footer">
          <div class="call-badge" id="lcCalls">ğŸ“ 0 touches</div>
          <div style="display:flex;align-items:center;gap:8px">
            <div class="prio-dot hot" id="lcPrio"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="swipe-row" id="swipeRow">
      <div class="swipe-lbl">â† Skip</div>
      <div class="swipe-lbl">Done / Next â†’</div>
    </div>
    <div id="tapHint" style="display:none;flex-direction:column;align-items:center;gap:6px;padding:10px 0 4px;width:100%;max-width:360px">
      <div style="font-size:11px;font-weight:800;color:rgba(255,255,255,.6);letter-spacing:.5px">â† SWIPE TO BROWSE</div>
    </div>
    <div class="action-row" id="actionRow">
      <button class="act-btn call-btn-main" onclick="doCall()">
        <span class="btn-icon">ğŸ“</span>
        <span class="btn-lbl">CALL</span>
        <span class="btn-sub" id="callNameLbl">LISA</span>
      </button>
      <button class="act-btn text-btn-main" id="textBtn" onclick="doTextMsg()">
        <span class="btn-icon">ğŸ’¬</span>
        <span class="btn-lbl">TEXT</span>
        <span class="btn-sub" id="textNameLbl">LISA</span>
      </button>
    </div>
    <div id="viewDetailRow" style="display:none;width:100%;max-width:360px;margin-top:10px;gap:10px;flex-direction:column">
      <button onclick="openCurrentDetail()" style="width:100%;padding:16px;background:rgba(255,255,255,.25);border:2px solid rgba(255,255,255,.45);border-radius:16px;font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:2px;color:#fff;cursor:pointer;backdrop-filter:blur(8px);transition:all .15s">
        VIEW DEAL DETAILS â†’
      </button>
      <div style="display:flex;gap:10px">
        <button onclick="doCall()" style="flex:1;padding:13px;background:rgba(0,200,150,.25);border:2px solid rgba(0,200,150,.45);border-radius:14px;font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:1.5px;color:#fff;cursor:pointer;transition:all .15s">ğŸ“ CALL</button>
        <button onclick="doText()" style="flex:1;padding:13px;background:rgba(139,92,246,.25);border:2px solid rgba(139,92,246,.45);border-radius:14px;font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:1.5px;color:#fff;cursor:pointer;transition:all .15s">ğŸ’¬ TEXT</button>
      </div>
    </div>
  </div>

  <!-- DAILY PLAYS (empty state) -->
  <div id="noLeads" style="display:none;width:100%;padding:0 18px;flex-direction:column;align-items:center">
    <div class="plays-header">
      <h2>YOUR DAILY PLAYS</h2>
      <p id="playsSubhead">No leads in queue â€” run these 3 plays to keep money moving</p>
    </div>
    <div id="playsContainer"></div>
    <button class="add-lead-small" onclick="goAdd()">ï¼‹ Add a Lead</button>
  </div>
  <!-- BOTTOM TAB BAR -->
  <div class="tab-bar">
    <div class="tab-item active" id="tab-hot" onclick="switchTab('hot')">
      <span class="tab-icon">ğŸ”¥</span>
      <span class="tab-label">Hot</span>
      <span class="tab-badge" id="hotBadge" style="display:none">0</span>
    </div>
    <div class="tab-item" id="tab-warm" onclick="switchTab('warm')">
      <span class="tab-icon">â˜€ï¸</span>
      <span class="tab-label">Warm</span>
      <span class="tab-badge" id="warmBadge" style="display:none;background:#FF8E53">0</span>
    </div>
    <div class="tab-item" id="tab-contract" onclick="switchTab('contract')">
      <span class="tab-icon">ğŸ“‹</span>
      <span class="tab-label">Contract</span>
      <span class="tab-badge" id="contractBadge" style="display:none;background:#1A73E8">0</span>
    </div>
    <div class="tab-item" id="tab-people" onclick="switchTab('people')">
      <span class="tab-icon">ğŸ’›</span>
      <span class="tab-label">My People</span>
      <span class="tab-badge" id="peopleBadge" style="display:none;background:#FFB830">0</span>
    </div>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• POST-CALL SHEET â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay hidden" id="pcOverlay">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="close-x" onclick="closePCSheet()">âœ•</div>
    <div class="sh">
      <div class="sheet-title">HOW'D IT GO?</div>
      <div class="sheet-sub" id="pcSub">Log your call</div>
      <div class="oc-row">
        <div class="oc-btn" id="oc-answered" onclick="pickOutcome('answered')"><span class="oci">âœ…</span>Answered</div>
        <div class="oc-btn" id="oc-noanswer" onclick="pickOutcome('noanswer')"><span class="oci">ğŸ”‡</span>No Answer</div>
        <div class="oc-btn" id="oc-voicemail" onclick="pickOutcome('voicemail')"><span class="oci">ğŸ“¬</span>Voicemail</div>
      </div>

      <textarea class="modal-notes" id="callNotes" placeholder="Quick note... (use keyboard dictation)" style="width:100%;box-sizing:border-box"></textarea>
      <button class="save-btn" onclick="saveCall()">SAVE & NEXT LEAD â€º</button>
    </div>
  </div>
</div

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• DAILY PLAYS MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="playsOv" class="hidden" style="z-index:10000">
  <div class="sum-wrap">
    <div class="sum-head">
      <div class="sum-back" onclick="closePlays()">â†</div>
      <div class="sum-title">ğŸ’¡ DAILY PLAYS</div>
    </div>
    <div class="sum-body">
      <div class="sum-lbl" style="margin-bottom:16px">Quick prospecting ideas to keep your pipeline full</div>
      
      <div class="play-item" onclick="togglePlay(0)">
        <div class="play-check" id="play0">âšª</div>
        <div class="play-content">
          <div class="play-title">ğŸ“ Call 5 Expired Listings</div>
          <div class="play-desc">Find fresh expireds in your farm area and make contact today</div>
          <div class="play-pts">+40 pts</div>
        </div>
      </div>
      
      <div class="play-item" onclick="togglePlay(1)">
        <div class="play-check" id="play1">âšª</div>
        <div class="play-content">
          <div class="play-title">ğŸšª Door Knock Your Farm</div>
          <div class="play-desc">Hit 20 doors in your territory â€” leave your card and a smile</div>
          <div class="play-pts">+50 pts</div>
        </div>
      </div>
      
      <div class="play-item" onclick="togglePlay(2)">
        <div class="play-check" id="play2">âšª</div>
        <div class="play-content">
          <div class="play-title">ğŸ’¬ Text 10 Past Clients</div>
          <div class="play-desc">Quick check-in: "How's the house treating you?"</div>
          <div class="play-pts">+30 pts</div>
        </div>
      </div>
      
    </div>
  </div>
</div>>



<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• PLAY DETAIL SHEET â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay hidden" id="playOverlay">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sh">
      <div class="sheet-title" id="playDetailTitle">PLAY</div>
      <div class="sheet-sub" id="playDetailSub"></div>
      <div class="script-card call-type" style="margin-bottom:13px">
        <div class="sc-head">
          <div class="sc-tag" id="playScriptTag">ğŸ“ SCRIPT / APPROACH</div>
          <button class="copy-btn" id="copyPlayBtn" onclick="copyEl('playScriptBody','copyPlayBtn')">â˜ Copy</button>
        </div>
        <div class="sc-body" id="playScriptBody"></div>
      </div>
      <button class="save-btn" id="playActionBtn" onclick="executePlay()">LET'S GO â€º</button>
      <button class="cancel-btn" onclick="closePlay()">Maybe Later</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ADD LEAD SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- DELETE CONFIRM OVERLAY -->
<div class="overlay hidden" id="deleteOverlay">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sh">
      <div class="sheet-title" style="color:#FF4757">DELETE LEAD?</div>
      <div class="sheet-sub" id="deleteSub">This cannot be undone.</div>
      <div style="background:#FFF0F0;border:1.5px solid #FFB3B3;border-radius:14px;padding:14px 16px;margin-bottom:16px">
        <div style="font-size:13px;font-weight:700;color:#CC0000;line-height:1.6;white-space:pre-line" id="deleteDetails"></div>
      </div>
      <button onclick="deleteLead()" style="width:100%;padding:16px;background:#FF4757;border:none;border-radius:15px;font-family:'Bebas Neue',sans-serif;font-size:19px;letter-spacing:2px;color:#fff;cursor:pointer;margin-bottom:10px">YES DELETE THIS LEAD</button>
      <button onclick="closeDelete()" style="width:100%;padding:13px;background:transparent;border:1.5px solid #E8E8EC;border-radius:13px;font-family:'Nunito',sans-serif;font-weight:800;font-size:14px;color:#AAA;cursor:pointer">Cancel â€” Keep Lead</button>
    </div>
  </div>
</div>

<div class="screen hidden" id="screen-add">
  <div class="add-head">
    <div class="back-btn" onclick="goBack()">â†</div>
    <h2>ADD LEAD</h2>
  </div>
  <div class="add-form">
    <div>
      <label class="f-lbl">Buyer or Seller?</label>
      <div class="tog-row">
        <div class="tog-opt sel" id="tBuyer" onclick="setType('buyer')">ğŸ  Buyer</div>
        <div class="tog-opt" id="tSeller" onclick="setType('seller')">ğŸ’° Seller</div>
      </div>
    </div>
    <div>
      <label class="f-lbl">Stage *</label>
      <div class="tog-row" style="margin-bottom:8px">
        <div class="tog-opt" id="sHot" onclick="setStage('hot')">ğŸ”¥ Hot</div>
        <div class="tog-opt" id="sWarm" onclick="setStage('warm')">â˜€ï¸ Warm</div>
      </div>
      <div class="tog-row">
        <div class="tog-opt" id="sContract" onclick="setStage('contract')">ğŸ“‹ Contract</div>
        <div class="tog-opt" id="sPeople" onclick="setStage('people')">ğŸ’› My People</div>
      </div>
    </div>
    
    <!-- CONTRACT FIELDS (show when Contract selected) -->
    <div id="addContractFields" style="display:none">
      <div><label class="f-lbl">Contract Accepted Date *</label><input class="f-in" id="aContractDate" type="date"></div>
      <div><label class="f-lbl">Close of Escrow Date *</label><input class="f-in" id="aCOE" type="date"></div>
      <div><label class="f-lbl">Property Address *</label><input class="f-in" id="aContractAddr" type="text" placeholder="e.g. 1845 W Bullard Ave, Fresno CA"></div>
    </div>
    <div><label class="f-lbl">Full Name *</label><input class="f-in" id="aName" type="text" placeholder="e.g. Lisa Johnson" autocomplete="name"></div>
    <div><label class="f-lbl">Phone Number *</label><input class="f-in" id="aPhone" type="tel" placeholder="(559) 555-0100" autocomplete="tel"></div>
    <div><label class="f-lbl">Property Address <span style="font-weight:600;opacity:.5">(if known)</span></label><input class="f-in" id="aAddr" type="text" placeholder="e.g. 4821 N Blackstone, Fresno"></div>
    <div><label class="f-lbl">Lead Source</label><input class="f-in" id="aSource" type="text" placeholder="e.g. Expired, FSBO, Zillow, Referral..."></div>
    <div><label class="f-lbl">Email <span style="font-weight:600;opacity:.5">(optional)</span></label><input class="f-in" id="aEmail" type="email" placeholder="e.g. name@gmail.com" autocomplete="email"></div>
    <div><label class="f-lbl">Birthday <span style="font-weight:600;opacity:.5">(optional)</span></label><input class="f-in" id="aBirthday" type="date"></div>
    <div>
      <label class="f-lbl">Key Situation <span style="font-weight:600;opacity:.5">(motivator)</span></label>
      <input class="f-in" id="aNote" type="text" placeholder="e.g. Needs to sell in 60 days... (use keyboard dictation)">
    </div>
    <div>
      <label class="f-lbl">Personal Notes <span style="font-weight:600;opacity:.5">(spouse, pets, interests...)</span></label>
      <textarea class="f-in" id="aPersonal" placeholder="e.g. Wife is Sarah. Dog named Ranger. Big Dodgers fan." style="height:70px;resize:none;padding-top:12px"></textarea>
    </div>

    <button class="save-lead-btn" onclick="saveLead()">ADD TO QUEUE â€º</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCORE OVERLAY â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="scoreOv" class="hidden">
  <div class="sc-lbl">TODAY'S SCORE</div>
  <div class="sc-big" id="sBig">0</div>
  <div class="sc-grid">
    <div class="sc-cell"><div class="sc-num" id="sCalls">0</div><div class="sc-cell-lbl">Calls</div></div>
    <div class="sc-cell"><div style="font-size:30px;line-height:1" id="sStreak">âšª</div><div class="sc-cell-lbl">Streak</div></div>
    <div class="sc-cell"><div class="sc-num" style="color:#B5EAFF" id="sConnects">0</div><div class="sc-cell-lbl">Connects</div></div>
  </div>
  <div class="sc-msg" id="sMsg"></div>

  <button class="sc-close" onclick="closeScore()">KEEP DIALING ğŸ”¥</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• WEEKLY SUMMARY OVERLAY â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="summaryOv" class="hidden">
  <div class="sum-label">WEEKLY REPORT</div>
  <div class="sum-week" id="sumWeek">Feb 10 â€“ 16, 2026</div>
  <div class="sum-grid">
    <div class="sum-cell"><div class="sum-num" id="sumCalls">0</div><div class="sum-cell-lbl">Total Calls</div></div>
    <div class="sum-cell"><div class="sum-num" id="sumConnects">0</div><div class="sum-cell-lbl">Connects</div></div>
    <div class="sum-cell"><div class="sum-num" id="sumTexts">0</div><div class="sum-cell-lbl">Texts Sent</div></div>
    <div class="sum-cell"><div class="sum-num" id="sumLeads">0</div><div class="sum-cell-lbl">Leads Added</div></div>
  </div>
  <div class="sum-streak">
    <div class="sum-streak-fire" id="sumStreakFire">ğŸ”¥</div>
    <div class="sum-streak-txt" id="sumStreakTxt">0-Day Streak</div>
  </div>
  <div class="sum-challenge">
    <div class="sum-challenge-lbl">ğŸ’¡ THIS WEEK'S INSIGHT</div>
    <div class="sum-challenge-txt" id="sumInsight"></div>
  </div>
  <div class="sum-quote">
    <div class="sum-quote-txt" id="sumQuote"></div>
    <div class="sum-quote-author" id="sumAuthor"></div>
  </div>
  <button class="sum-close" onclick="closeSummary()">BACK TO DIALING ğŸ”¥</button>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let leads = JSON.parse(localStorage.getItem('du3_leads')||'[]');
let stats = JSON.parse(localStorage.getItem('du3_stats')||'{"pts":0,"streak":0,"lastDate":"","callsToday":0,"connectsToday":0,"textsToday":0,"leadsAdded":0,"weekCalls":0,"weekConnects":0,"weekTexts":0,"weekLeads":0,"mode":"motivator"}');
let idx=0, outcome=null, hotMode=false, addType='buyer', addStage='warm', activeTab='hot';
let recognition=null, isRec=false, addRec=null, addIsRec=false;
let currentPlay=null;

if(!leads.length){
  leads=[];
if(!leads.length){
  // Empty on first load - user will add their own leads
  save();
}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• UTILS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function save(){localStorage.setItem('du3_leads',JSON.stringify(leads));localStorage.setItem('du3_stats',JSON.stringify(stats))}
function toast(msg,dur=2200){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),dur)}
function ds(iso){if(!iso)return null;return Math.floor((Date.now()-new Date(iso).getTime())/86400000)}
function fmtDays(d){
  if(d===null)return{txt:'New',cls:'fresh'};
  if(d===0)return{txt:'Today',cls:'fresh'};
  if(d===1)return{txt:'1 day ago',cls:'warm'};
  if(d<=4)return{txt:d+' days ago',cls:'warm'};
  return{txt:d+' days ago',cls:'urgent'};
}
function fmtPhone(p){const c=(p||'').replace(/\D/g,'');return c.length===10?`(${c.slice(0,3)}) ${c.slice(3,6)}-${c.slice(6)}`:p}
function checkDay(){
  const today=new Date().toDateString();
  if(stats.lastDate!==today){
    if(stats.callsToday>0)stats.streak=(stats.streak||0)+1;
    else if(stats.lastDate){const yd=new Date(Date.now()-86400000).toDateString();if(stats.lastDate!==yd)stats.streak=0}
    // reset daily (keep weekly rolling)
    stats.callsToday=0;stats.connectsToday=0;stats.textsToday=0;
    stats.lastDate=today;save();
  }
}

/* NUDGE STATS */
const nudgeStats=[
  "The average lead needs 8 touches before saying yes. Stay in it.",
  "Agents who follow up within 24hrs are 7Ã— more likely to close.",
  "Your competition probably called them yesterday.",
  "80% of sales happen between the 5th and 12th contact.",
  "One callback today could be a contract next month.",
  "Consistency beats talent in real estate â€” every single time.",
  "Most agents quit at touch 3. You're not most agents."
];
/* â”€â”€ AUTO-VOICE MESSAGE BANKS â”€â”€ */
const motivatorHigh=["You're building something real â€” keep going! ğŸ’ª","Momentum is everything. You've got it today.","This is what separates good agents from great ones.","Every connect is a relationship. Every relationship is a deal.","You're putting in the work. The market will reward it.","Consistency beats talent every single time. Stay in it."];
const motivatorLow=["Every dial is a step closer to the close. Let's go!","One call today can change your whole week. Make it.","The pipeline doesn't build itself â€” but you can. Right now.","Your next closed deal starts with your next call. Dial.","Champions show up even on slow days. This is that day."];
const competitorHigh=["Your competition already called 10 people today. You're keeping up.","Top producers don't take days off. Neither do you.","You're lapping every agent who's still checking their phone.","The leaderboard isn't official â€” but you're winning it."];
const competitorLow=["Your competition is dialing right now. Are you?","Someone else is calling YOUR leads. Don't let them.","The agent who calls more wins. Simple as that.","While you're waiting, another agent is closing your deal.","Every hour you don't dial is an hour your competition does."];
const quotes=[];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RENDER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render(){
  checkDay();
  document.getElementById('streakNum').textContent=stats.streak||0;

  updateBadges();
  const active=getTabLeads();

  if(!active.length){
    document.getElementById('cardZone').style.display='none';
    const nl=document.getElementById('noLeads');
    nl.style.display='flex';
    renderPlays();
    return;
  }
  document.getElementById('noLeads').style.display='none';
  document.getElementById('cardZone').style.display='flex';
  if(idx>=active.length)idx=0;
  const l=active[idx];

  // Contract + People tabs: hide call actions, show tap hint
  const isViewOnly = (activeTab==='contract'||activeTab==='people');
  const swipeRow = document.getElementById('swipeRow');
  const actionRow = document.getElementById('actionRow');
  const tapHint = document.getElementById('tapHint');
  if(swipeRow) swipeRow.style.display = isViewOnly ? 'none' : 'flex';
  if(actionRow) actionRow.style.display = isViewOnly ? 'none' : 'flex';
  if(tapHint) tapHint.style.display = isViewOnly ? 'flex' : 'none';
  const vdr = document.getElementById('viewDetailRow');
  if(vdr) vdr.style.display = isViewOnly ? 'flex' : 'none';
  const d=ds(l.lastContact);
  const{txt,cls}=fmtDays(d);

  // nudge
  const banner=document.getElementById('nudgeBanner');
  // COE follow-up nudge check
  if(l.followups){
    const now=Date.now();
    const upcoming=Object.entries(l.followups).find(([k,v])=>{
      const diff=(new Date(v).getTime()-now)/(86400000);
      return diff>=0&&diff<=3;
    });
    if(upcoming){
      const labels={days7:'7-Day Post-Close Check-In',days30:'30-Day Check-In',days90:'90-Day Check-In',anniversary:'ğŸ¡ 1-Year Home Anniversary'};
      banner.style.display='block';
      document.getElementById('nudgeTop').textContent='ğŸ“… Coming up: '+labels[upcoming[0]]+' with '+l.name.split(' ')[0];
      document.getElementById('nudgeStat').textContent='ğŸ’¡ Tap to see their suggested script â€” this touch earns referrals for life.';
    }
  }

  if(d!==null&&d>=7){
    banner.style.display='block';
    const voice=getAutoVoice();
    const fn=l.name.split(' ')[0];
    const nudgePrefix=voice==='competitor'
      ?`âš”ï¸ ${d} days since last touch with ${fn} â€” your competition may have called them already.`
      :`â° ${d} days since last touch with ${fn} â€” a quick call today keeps the relationship warm.`;
    document.getElementById('nudgeTop').textContent=nudgePrefix;
    const si=nudgeStats[Math.floor(Math.random()*nudgeStats.length)];
    document.getElementById('nudgeStat').textContent='ğŸ’¡ '+si;
  }else{banner.style.display='none';}

  // Stage badge
  const stageLabels={hot:'ğŸ’° SELLER',warm:'ğŸ’° SELLER',contract:'ğŸ“‹ IN CONTRACT',people:'ğŸ’› MY PEOPLE'};
  const stageBuyer={hot:'ğŸ  BUYER',warm:'ğŸ  BUYER',contract:'ğŸ“‹ IN CONTRACT',people:'ğŸ’› MY PEOPLE'};
  const stage=l.stage||'warm';
  if(stage==='contract'){
    document.getElementById('lcType').textContent='ğŸ“‹ IN CONTRACT';
    document.getElementById('lcType').style.background='linear-gradient(135deg,#1A73E8,#0D5BC4)';
  } else if(stage==='people'){
    document.getElementById('lcType').textContent='ğŸ’› MY PEOPLE';
    document.getElementById('lcType').style.background='linear-gradient(135deg,#FFB830,#FF8E53)';
  } else {
    document.getElementById('lcType').textContent=l.type==='buyer'?'ğŸ  BUYER':'ğŸ’° SELLER';
    document.getElementById('lcType').style.background='linear-gradient(135deg,var(--coral),var(--peach))';
    // Card top accent line per stage
    const card=document.getElementById('leadCard');
    if(stage==='contract') card.style.setProperty('--card-accent','#1A73E8');
    else if(stage==='people') card.style.setProperty('--card-accent','#FFB830');
    else if(stage==='hot') card.style.setProperty('--card-accent','#FF4757');
    else card.style.setProperty('--card-accent','#FF8E53');
  }
  document.getElementById('lcName').textContent=l.name.toUpperCase();
  document.getElementById('lcSource').textContent=(l.source||'â€”')+' Â· '+fmtPhone(l.phone||'');
  document.getElementById('lcNote').textContent=l.note||'No notes yet';
  document.getElementById('lcCalls').textContent='ğŸ“ '+(l.calls||0)+' touch'+(l.calls!==1?'es':'');
  document.getElementById('lcPrio').className='prio-dot '+(l.priority||'warm');
  const dc=document.getElementById('lcDays');dc.textContent='ğŸ• '+txt;dc.className='days-chip '+(cls||'');
  const fn=l.name.split(' ')[0].toUpperCase();
  document.getElementById('callNameLbl').textContent=fn;
  document.getElementById('textNameLbl').textContent=fn;
  const pct=leads.length?Math.round(leads.filter(l=>l.done).length/leads.length*100):0;
  document.getElementById('progFill').style.width=pct+'%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DAILY PLAYS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const allPlays=[
  {id:'expired',type:'prospect',icon:'ğŸ”',title:'Check Expired Listings',tag:'PROSPECTING',
   desc:'Pull today\'s expired listings on the MLS. Call them â€” they need an agent RIGHT NOW.',
   script:`"Hi, this is Wring with Berkshire Hathaway. I noticed your home came off the market recently and I wanted to reach out â€” I specialize in relaunching listings that didn't sell the first time.\n\nI've had strong success in your area lately and I'd love to share what I'd do differently. Do you have about 5 minutes today?"`,
   action:'PULL EXPIRED LISTINGS'},
  {id:'farm',type:'intel',icon:'ğŸ˜ï¸',title:'Work Your Farm',tag:'MARKET INTEL',
   desc:'Check what sold or went active in your farm this week. Call 3 neighbors with the news.',
   script:`"Hi [Name], this is Wring with Berkshire Hathaway â€” just wanted to give you a quick heads-up. A home on [Street] just sold for $[Price], which is great news for your neighborhood's value.\n\nHave you thought about what your home might be worth right now? I'd be happy to share what I'm seeing."`,
   action:'OPEN MLS'},
  {id:'postdeal',type:'brand',icon:'ğŸ†',title:'Post Your Deal of the Week',tag:'BRAND BUILDING',
   desc:'Share a recent sale, price reduction win, or market stat on social. One post = 100+ impressions.',
   script:`DEAL OF THE WEEK ğŸ¡\n\nJust closed [address] at $[price] â€” [X] days on market, [Y] offers.\n\nIf you've been thinking about making a move in [neighborhood], NOW is the time. The buyers are out there.\n\nğŸ“² DM me or call [number]\n#FresnoRealEstate #BerkhireHathaway #JustClosed`,
   action:'OPEN SOCIAL'},
  {id:'pastclient',type:'intel',icon:'ğŸ’Œ',title:'Reconnect With a Past Client',tag:'RELATIONSHIP',
   desc:'Pick one client you haven\'t talked to in 90+ days. One check-in text = one referral pipeline.',
   script:`"Hi [Name]! It's Wring â€” just thinking about you and wanted to check in. How's everything going at [address]?\n\nAlso wanted to let you know the market has been moving in your area â€” happy to give you a quick update on your home's value if you're ever curious. Hope all is well!"`,
   action:'OPEN CONTACTS'},
  {id:'vendor',type:'brand',icon:'ğŸ¤',title:'Spotlight a Local Vendor',tag:'COMMUNITY',
   desc:'Post about a contractor, lender, or local business you trust. Become the connector in your market.',
   script:`VENDOR SPOTLIGHT ğŸŒŸ\n\nShoutout to [Business Name] â€” if you're looking for a reliable [contractor/lender/inspector] in the Fresno area, these are my go-to people.\n\n[One sentence about why you trust them]\n\nBuilding great relationships is what great real estate is all about ğŸ¡\n\n#Fresno #LocalBusiness #RealEstate`,
   action:'OPEN SOCIAL'},
  {id:'review',type:'brand',icon:'â­',title:'Ask for a Google Review',tag:'REPUTATION',
   desc:'Text one past client asking for a Google review. 5 minutes = more leads for months.',
   script:`"Hi [Name], hope you're loving the new place! ğŸ \n\nWould mean the world to me if you had 2 minutes to leave me a Google review â€” it helps other families find me when they're ready to make a move.\n\nHere's the link: [your Google review link]\n\nThank you so much â€” you're the best!"`,
   action:'COPY SCRIPT'},
];

function renderPlays(){
  const container=document.getElementById('playsContainer');
  const voice=getAutoVoice();
  const sub=document.getElementById('playsSubhead');
  const h2=document.querySelector('.plays-header h2');
  // Tab-aware empty state messaging
  if(activeTab==='hot'){
    if(h2) h2.textContent='NO HOT LEADS';
    if(sub) sub.textContent='No hot leads right now â€” promote a warm lead or add a new one.';
    container.innerHTML='';return;
  }
  if(activeTab==='warm'){
    if(h2) h2.textContent='NO WARM LEADS';
    if(sub) sub.textContent='Queue is clear â€” add new leads or check your Daily Plays below.';
  } else if(activeTab==='contract'){
    if(h2) h2.textContent='NO ACTIVE CONTRACTS';
    if(sub) sub.textContent='No contracts in progress â€” keep dialing your hot leads to get here.';
    container.innerHTML='';return;
  }
  if(activeTab==='people'){
    if(h2) h2.textContent='MY PEOPLE';
    if(sub) sub.textContent='No past clients yet â€” closed deals will live here and generate referrals for life.';
    container.innerHTML='';return;
  }
  if(h2) h2.textContent='YOUR DAILY PLAYS';
  if(sub){
    sub.textContent=voice==='competitor'
      ?'Your competition is prospecting right now. Run these plays and stay ahead.'
      :'Queue is clear â€” great time to plant seeds. Run these 3 plays to keep money moving.';
  }
  // pick 3 plays â€” rotate by day of year
  const doy=Math.floor((Date.now()-new Date(new Date().getFullYear(),0,0))/(1000*60*60*24));
  const picks=[allPlays[doy%allPlays.length],allPlays[(doy+2)%allPlays.length],allPlays[(doy+4)%allPlays.length]];
  container.innerHTML=picks.map((p,i)=>`
    <div class="play-card play-${p.type}" onclick="openPlay('${p.id}')">
      <div class="play-num">PLAY ${i+1}</div>
      <div class="play-title">${p.icon} ${p.title}</div>
      <div class="play-desc">${p.desc}</div>
      <div class="play-tag">${p.tag}</div>
    </div>
  `).join('');
}

function openPlay(id){
  currentPlay=allPlays.find(p=>p.id===id);
  if(!currentPlay)return;
  document.getElementById('playDetailTitle').textContent=currentPlay.icon+' '+currentPlay.title;
  document.getElementById('playDetailSub').textContent=currentPlay.desc;
  document.getElementById('playScriptBody').textContent=currentPlay.script;
  document.getElementById('playActionBtn').textContent=currentPlay.action+' â€º';
  document.getElementById('playScriptTag').textContent='ğŸ“‹ SCRIPT / COPY & USE';
  const btn=document.getElementById('copyPlayBtn');btn.textContent='â˜ Copy';btn.classList.remove('ok');
  document.getElementById('playOverlay').classList.remove('hidden');
  stats.pts=(stats.pts||0)+2;save();
}
function executePlay(){
  if(!currentPlay)return;
  if(currentPlay.action.includes('MLS'))window.open('https://www.mlslistings.com','_blank');
  else if(currentPlay.action.includes('SOCIAL'))window.open('https://www.instagram.com','_blank');
  else if(currentPlay.action.includes('CONTACTS'))window.open('tel:','_self');
  copyEl('playScriptBody','copyPlayBtn');
  toast('Play launched! +5 pts ğŸš€');
  stats.pts=(stats.pts||0)+5;save();
  setTimeout(closePlay,800);
}
function closePlay(){document.getElementById('playOverlay').classList.add('hidden')}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB NAVIGATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function switchTab(tab){
  activeTab = tab;
  idx = 0;
  ['hot','warm','contract','people'].forEach(t => {
    const el=document.getElementById('tab-'+t);
    if(el) el.classList.toggle('active', t===tab);
  });
  render();
}

function getTabLeads(){
  if(activeTab==='hot') return leads.filter(l=>l.stage==='hot');
  if(activeTab==='warm') return leads.filter(l=>l.stage==='warm'||(!l.stage&&l.priority!=='hot'));
  if(activeTab==='contract') return leads.filter(l=>l.stage==='contract');
  if(activeTab==='people') return leads.filter(l=>l.stage==='people');
  return leads.filter(l=>!l.done);
}

function updateBadges(){
  const hot=leads.filter(l=>l.stage==='hot').length;
  const warm=leads.filter(l=>l.stage==='warm'||(!l.stage&&l.priority!=='hot')).length;
  const contract=leads.filter(l=>l.stage==='contract').length;
  const people=leads.filter(l=>l.stage==='people').length;
  const hb=document.getElementById('hotBadge');
  const wb=document.getElementById('warmBadge');
  const cb=document.getElementById('contractBadge');
  const pb=document.getElementById('peopleBadge');
  if(hb){hb.textContent=hot;hb.style.display=hot>0?'flex':'none';}
  if(wb){wb.textContent=warm;wb.style.display=warm>0?'flex':'none';}
  if(cb){cb.textContent=contract;cb.style.display=contract>0?'flex':'none';}
  if(pb){pb.textContent=people;pb.style.display=people>0?'flex':'none';}
}

function toggleHot(){switchTab('hot')}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SWIPE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let tx=null;
let wasSwiping=false;
document.addEventListener('DOMContentLoaded',()=>{
  const c=document.getElementById('leadCard');
  c.addEventListener('touchstart',e=>{tx=e.touches[0].clientX;wasSwiping=false;c.classList.add('dragging')},{passive:true});
  c.addEventListener('touchmove',e=>{if(tx===null)return;const dx=e.touches[0].clientX-tx;if(Math.abs(dx)>10)wasSwiping=true;c.style.transform=`translateX(${dx}px) rotate(${dx*.042}deg)`},{passive:true});
  c.addEventListener('touchend',e=>{
    if(tx===null)return;
    const dx=e.changedTouches[0].clientX-tx;
    c.classList.remove('dragging');c.style.transform='';tx=null;
    if(dx>65)nextLead();else if(dx<-65)nextLead(true);
    // Reset swipe flag after a brief delay to allow click handler to check it
    setTimeout(()=>wasSwiping=false,50);
  });
  render();
});
function nextLead(skip=false){
  const active=getTabLeads();
  if(!active.length){render();return}
  // Contract + People: just cycle, never remove
  if(activeTab==='contract'||activeTab==='people'){
    if(active.length<=1){
      // Only one â€” open detail directly
      openCurrentDetail();
      return;
    }
    idx=(idx+1)%active.length;
    const c=document.getElementById('leadCard');
    c.style.opacity='0';c.style.transform='translateX(38px)';
    requestAnimationFrame(()=>{c.style.transition='all .26s';c.style.opacity='1';c.style.transform='';});
    setTimeout(()=>c.style.transition='',290);
    render();
    return;
  }
  idx=(idx+1)%active.length;
  const c=document.getElementById('leadCard');
  c.style.opacity='0';c.style.transform='translateX(38px)';
  requestAnimationFrame(()=>{c.style.transition='all .26s';c.style.opacity='1';c.style.transform='';});
  setTimeout(()=>c.style.transition='',290);
  if(skip)toast('Skipped');else toast('Next up! â†’');
  render();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CALL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doCall(){
  try {
    const active=getTabLeads();
    if(!active.length){toast('No leads in queue');return;}
    const l=active[idx];
    if(!l){toast('Lead not found');return;}
    if(!l.phone){toast('No phone number');return;}
    const ph=l.phone.replace(/\D/g,'');
    if(!ph){toast('Invalid phone number');return;}
    
    // Log the call BEFORE opening dialer
    l.calls=(l.calls||0)+1;
    l.lastContact=new Date().toISOString();
    stats.callsToday=(stats.callsToday||0)+1;
    stats.weekCalls=(stats.weekCalls||0)+1;
    stats.pts=(stats.pts||0)+5;
    save();
    
    // Show post-call sheet BEFORE opening dialer so it's waiting when user returns
    try {
      outcome=null;
      ['answered','noanswer','voicemail'].forEach(o=>{
        const el=document.getElementById('oc-'+o);
        if(el)el.className='oc-btn';
      });
      const notes=document.getElementById('callNotes');
      if(notes)notes.value='';
      const sub=document.getElementById('pcSub');
      if(sub)sub.textContent='Log your call with '+l.name;
      const overlay=document.getElementById('pcOverlay');
      if(overlay)overlay.classList.remove('hidden');
    } catch(e) {
      console.error('Post-call sheet error:',e);
    }
    
    // Open phone dialer LAST (this will leave the app)
    window.open('tel:'+ph, '_self');
    
  } catch(e) {
    console.error('doCall error:',e);
    toast('Error making call');
  }
}



function doTextMsg(){
  try {
    const active=getTabLeads();
    if(!active.length){toast('No leads in queue');return;}
    const l=active[idx];
    if(!l){toast('Lead not found');return;}
    if(!l.phone){toast('No phone number');return;}
    const ph=l.phone.replace(/\D/g,'');
    if(!ph){toast('Invalid phone number');return;}
    
    // Log the text
    l.texts=(l.texts||0)+1;
    stats.texts=(stats.texts||0)+1;
    stats.textsToday=(stats.textsToday||0)+1;
    stats.weekTexts=(stats.weekTexts||0)+1;
    stats.pts=(stats.pts||0)+3;
    save();
    
    // Open Messages app
    window.open('sms:'+ph, '_self');
    toast('ğŸ’¬ +3 pts');
  } catch(e) {
    console.error('doTextMsg error:',e);
    toast('Error opening messages');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TEXT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• POST CALL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pickOutcome(o){
  outcome=o;
  ['answered','noanswer','voicemail'].forEach(x=>document.getElementById('oc-'+x).className='oc-btn'+(x===o?' sel-'+x:''));
  const active=getTabLeads();
  if(!active.length)return;
  const l=active[idx],fn=l.name.split(' ')[0];
  
  
  const b=document.getElementById('copyScriptBtn');b.textContent='â˜ Copy';b.classList.remove('ok');
}

function saveCall(){
  if(!outcome){toast('Pick an outcome first â˜ï¸');return}
  const active=getTabLeads();
  const l=active[idx];
  const notes=document.getElementById('callNotes').value.trim();
  
  // Log the call NOW (when outcome is saved)
  l.calls=(l.calls||0)+1;
  l.lastContact=new Date().toISOString();
  stats.callsToday=(stats.callsToday||0)+1;
  stats.weekCalls=(stats.weekCalls||0)+1;
  
  if(outcome==='answered'){l.connects=(l.connects||0)+1;stats.connectsToday=(stats.connectsToday||0)+1;stats.weekConnects=(stats.weekConnects||0)+1;stats.pts=(stats.pts||0)+20;}
  else stats.pts=(stats.pts||0)+8;
  // Add timestamp to notes
  if(notes){
    const now=new Date();
    const timestamp=now.toLocaleString('en-US',{month:'short',day:'numeric',hour:'numeric',minute:'2-digit',hour12:true});
    const timestampedNote='['+timestamp+'] '+notes;
    l.note=timestampedNote+(l.note?'\n'+l.note:'');
  }
  l.lastOutcome=outcome;save();
  document.getElementById('pcOverlay').classList.add('hidden');
  toast(outcome==='answered'?'ğŸ‰ Connect! +25 pts':'+8 pts logged âœ“');
  setTimeout(()=>nextLead(),300);render();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• COPY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function copyEl(elId,btnId){
  const txt=document.getElementById(elId).textContent;
  const btn=document.getElementById(btnId);
  const orig=btn.textContent;
  try{navigator.clipboard.writeText(txt).then(()=>{btn.textContent='âœ“ Copied!';btn.classList.add('ok');toast('Copied! ğŸ“‹');setTimeout(()=>{btn.textContent=orig;btn.classList.remove('ok')},2200)});}
  catch(e){const ta=document.createElement('textarea');ta.value=txt;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);btn.textContent='âœ“ Copied!';btn.classList.add('ok');toast('Copied!');setTimeout(()=>{btn.textContent=orig;btn.classList.remove('ok')},2200);}
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DELETE LEAD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function confirmDelete(){
  const active=getTabLeads();
  if(!active.length)return;
  const l=active[idx];
  document.getElementById('deleteSub').textContent='Remove '+l.name+' from your queue?';
  document.getElementById('deleteDetails').textContent=
    (l.type==='seller'?'ğŸ’° Seller':'ğŸ  Buyer')+' Â· '+(l.source||'No source')+
    (l.address?'\nğŸ“ '+l.address:'')+
    '\nğŸ“ Called '+(l.calls||0)+' time'+(l.calls!==1?'s':'');
  document.getElementById('deleteOverlay').classList.remove('hidden');
}
function deleteLead(){
  const active=getTabLeads();
  if(!active.length)return;
  const l=active[idx];
  leads=leads.filter(ld=>ld.id!==l.id);
  if(idx>=leads.filter(ld=>!ld.done).length)idx=0;
  save();
  document.getElementById('deleteOverlay').classList.add('hidden');
  toast('Lead deleted');
  render();
}
function closeDelete(){document.getElementById('deleteOverlay').classList.add('hidden')}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ADD LEAD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goAdd(){
  document.getElementById('screen-main').classList.add('hidden');
  document.getElementById('screen-add').classList.remove('hidden');
  addType='buyer';
  addStage=''; // No default
  // Clear all stage selections
  ['sHot','sWarm','sContract','sPeople'].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.classList.remove('sel');
  });
  // Hide contract fields
  const cf=document.getElementById('addContractFields');
  if(cf) cf.style.display='none';
}
function goBack(){document.getElementById('screen-add').classList.add('hidden');document.getElementById('screen-main').classList.remove('hidden');render()}
function setType(t){addType=t;document.getElementById('tBuyer').classList.toggle('sel',t==='buyer');document.getElementById('tSeller').classList.toggle('sel',t==='seller')}
function setStage(s){
  addStage=s;
  document.getElementById('sHot').classList.toggle('sel',s==='hot');
  document.getElementById('sWarm').classList.toggle('sel',s==='warm');
  document.getElementById('sContract').classList.toggle('sel',s==='contract');
  document.getElementById('sPeople').classList.toggle('sel',s==='people');
  // Show/hide contract fields
  const cf=document.getElementById('addContractFields');
  if(cf) cf.style.display=s==='contract'?'block':'none';
}
function saveLead(){
  try {
    const name=document.getElementById('aName').value.trim();
    const phone=document.getElementById('aPhone').value.trim();
    
    if(!name){toast('Name is required');return;}
    if(!phone){toast('Phone is required');return;}
    if(!addStage){toast('Please select a stage');return;}
    
    // Validate contract fields if Contract selected
    if(addStage==='contract'){
      const contractDate=document.getElementById('aContractDate').value;
      const coeDate=document.getElementById('aCOE').value;
      const contractAddr=document.getElementById('aContractAddr').value.trim();
      if(!contractDate){toast('Contract date required');return;}
      if(!coeDate){toast('COE date required');return;}
      if(!contractAddr){toast('Property address required for contracts');return;}
    }
    
    const nl={
      id:Date.now(),
      name:name,
      phone:phone.replace(/\D/g,''),
      type:addType,
      address:document.getElementById('aAddr').value.trim(),
      source:document.getElementById('aSource').value.trim(),
      email:document.getElementById('aEmail').value.trim(),
      note:document.getElementById('aNote').value.trim(),
      birthday:document.getElementById('aBirthday').value,
      personalNotes:document.getElementById('aPersonal').value.trim(),
      stage:addStage,
      priority:addStage==='hot'?'hot':'warm',
      calls:0,
      connects:0,
      texts:0,
      lastContact:null
    };
    
    // Add contract fields if Contract stage
    if(addStage==='contract'){
      nl.contractDate=document.getElementById('aContractDate').value;
      nl.coeDate=document.getElementById('aCOE').value;
      nl.contractAddr=document.getElementById('aContractAddr').value.trim();
      nl.milestones={};
    }
    
    // Add to leads array
    if(addStage==='hot'){
      leads.unshift(nl);
    } else {
      leads.push(nl);
    }
    
    // Update stats
    stats.pts=(stats.pts||0)+10;
    stats.leadsAdded=(stats.leadsAdded||0)+1;
    stats.weekLeads=(stats.weekLeads||0)+1;
    
    // Save to localStorage
    save();
    
    // Clear form
    ['aName','aPhone','aAddr','aSource','aEmail','aNote','aBirthday','aPersonal','aContractDate','aCOE','aContractAddr'].forEach(id=>{
      const el=document.getElementById(id);
      if(el) el.value='';
    });
    
    // Show success and go back
    toast('âœ“ Lead added! +10 pts');
    setTimeout(()=>{
      goBack();
      render();
    },500);
    
  } catch(e) {
    console.error('saveLead error:',e);
    toast('Error adding lead: '+e.message);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• VOICE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
function mkRec(cb){if(!SR)return null;const r=new SR();r.continuous=false;r.interimResults=false;r.lang='en-US';r.onresult=e=>cb(e.results[0][0].transcript);r.onerror=()=>toast('Mic error â€” check permissions');return r;}


function getAutoVoice(){
  /* Reads behavior and picks Motivator or Competitor tone automatically */
  const c=stats.callsToday||0;
  const streak=stats.streak||0;
  const connects=stats.connectsToday||0;
  // High activity = Motivator (celebrate momentum)
  // Low activity or streak at risk = Competitor (urgency kick)
  if(c===0) return 'competitor';           // No calls yet â€” need a push
  if(c<3 && streak===0) return 'competitor'; // Low calls + no streak â€” challenge them
  if(c>=5 || connects>=2) return 'motivator'; // Performing well â€” celebrate
  if(streak>=3) return 'motivator';          // Streak alive â€” keep it going
  return 'competitor';                       // Default to urgency for average days
}
function updateScoreMsg(){
  const c=stats.callsToday||0;
  const voice=getAutoVoice();
  // Zero calls â€” direct and honest
  if(c===0){
    const zeroMsgs=voice==='competitor'
      ?["Your competition is already dialing. First call is free.","Nobody ever closed a deal by not calling. Pick up the phone.","The only call that matters right now is the next one. Make it."]
      :["Make your first call to start your streak!","Every great day starts with one dial. This is that moment.","Your pipeline is waiting. One call opens the door."];
    document.getElementById('sMsg').textContent=zeroMsgs[Math.floor(Math.random()*zeroMsgs.length)];
    return;
  }
  // 1-4 calls â€” building momentum
  if(c<5){
    const buildMsgs=voice==='competitor'
      ?competitorLow
      :motivatorLow;
    document.getElementById('sMsg').textContent=`${c} call${c>1?'s':''} today. ` + buildMsgs[Math.floor(Math.random()*buildMsgs.length)];
    return;
  }
  // 5-9 calls â€” solid day
  if(c<10){
    const solidMsgs=voice==='competitor'
      ?competitorHigh
      :motivatorHigh;
    document.getElementById('sMsg').textContent=`${c} calls today â€” on fire ğŸ”¥ ` + solidMsgs[Math.floor(Math.random()*solidMsgs.length)];
    return;
  }
  // 10+ calls â€” elite territory
  const eliteMsgs=["${c} calls today. You're in the top 10% of agents for activity. ğŸ‘‘","Absolute legend. ${c} calls and counting.","This is what a top producer looks like. Keep going."];
  document.getElementById('sMsg').textContent=eliteMsgs[Math.floor(Math.random()*eliteMsgs.length)].replace('${c}',c);
}
function showScore(){
  checkDay();
  document.getElementById('sBig').textContent=stats.pts||0;
  document.getElementById('sCalls').textContent=stats.callsToday||0;
  document.getElementById('sConnects').textContent=stats.connectsToday||0;
  const s=Math.min(stats.streak||0,7);
  document.getElementById('sStreak').textContent=s>0?'ğŸ”¥'.repeat(s):'âšª';
  updateScoreMsg();
  document.getElementById('scoreOv').classList.remove('hidden');
}
function closeScore(){document.getElementById('scoreOv').classList.add('hidden')}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WEEKLY SUMMARY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showSummary(){
  checkDay();
  const now=new Date();
  const day=now.getDay(),diff=now.getDate()-day+(day===0?-6:1);
  const mon=new Date(now.setDate(diff));
  const sun=new Date(mon);sun.setDate(mon.getDate()+6);
  const fmt=d=>d.toLocaleDateString('en-US',{month:'short',day:'numeric'});
  document.getElementById('sumWeek').textContent=fmt(mon)+' â€“ '+fmt(sun)+', '+sun.getFullYear();
  document.getElementById('sumCalls').textContent=stats.weekCalls||0;
  document.getElementById('sumConnects').textContent=stats.weekConnects||0;
  document.getElementById('sumTexts').textContent=stats.weekTexts||0;
  document.getElementById('sumLeads').textContent=stats.weekLeads||0;
  const s=stats.streak||0;
  document.getElementById('sumStreakFire').textContent=s>0?'ğŸ”¥'.repeat(Math.min(s,7)):'âšª';
  document.getElementById('sumStreakTxt').textContent=s+'-Day Streak'+(s>=7?' ğŸ‘‘':s>=3?' ğŸ”¥':'');
  const wc=stats.weekCalls||0;
  const voice=getAutoVoice();
  let insight='';
  if(wc===0){
    insight=voice==='competitor'
      ?'No calls logged yet this week. Every agent in your market who opened their CRM today has a head start on you. One call changes that right now.'
      :'No calls logged yet this week. Every great week starts with a single dial. You can still make this week count.';
  } else if(wc<10){
    insight=voice==='competitor'
      ?`${wc} calls this week. The top producers in your market are hitting 20-30. You're ${20-wc} calls behind elite territory â€” close that gap.`
      :`${wc} calls this week â€” you're building! The average top producer hits 20-30 weekly calls. You're ${20-wc} away. Keep stacking.`;
  } else if(wc<20){
    insight=voice==='competitor'
      ?`${wc} calls this week. You're close to the 20-call mark where agents close 40% more deals. Don't let up now â€” someone else wants that business.`
      :`${wc} calls this week â€” solid momentum! Hit 20+ and you're in the top tier. Agents who reach that mark close 40% more deals. You're almost there.`;
  } else {
    insight=voice==='competitor'
      ?`${wc} calls this week â€” you're outworking the competition. Top 10% for agent activity. This is how market share gets taken.`
      :`${wc} calls this week â€” you're in the top 10% of agents for activity. This kind of consistency is exactly what builds a referral-based business. Keep it going.`;
  }
  document.getElementById('sumInsight').textContent=insight;

  document.getElementById('summaryOv').classList.remove('hidden');
}
function closeSummary(){document.getElementById('summaryOv').classList.add('hidden')}



function handleCardTap(e){
  // Don't trigger if was swiping
  if(wasSwiping)return;
  // Don't trigger if clicking a button
  if(e.target.tagName==='BUTTON'||e.target.closest('button'))return;
  // Open detail on tap anywhere on card
  openCurrentDetail();
}

function openCurrentDetail() {
  const active = getTabLeads();
  if (!active.length) return;
  const l = active[idx];
  openDetail(l.id);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONTACT DETAIL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let detailLeadId = null;
let dtType = 'buyer';

function openDetail(leadId) {
  const l = leads.find(ld => ld.id === leadId);
  if (!l) return;
  detailLeadId = leadId;
  dtType = l.type || 'buyer';
  dtStage = l.stage || 'warm';

  // Avatar initials
  const parts = l.name.trim().split(' ');
  const initials = parts.length >= 2 ? parts[0][0]+parts[parts.length-1][0] : parts[0].slice(0,2);
  document.getElementById('dtAvatar').textContent = initials.toUpperCase();
  document.getElementById('dtFullName').textContent = l.name.toUpperCase();
  document.getElementById('dtMeta').textContent = (l.source||'No source') + ' Â· ' + (l.priority==='hot'?'ğŸ”¥ Hot':'â˜€ï¸ Warm');

  // Fields
  document.getElementById('dtName').value = l.name || '';
  document.getElementById('dtPhone').value = l.phone ? fmtPhone(l.phone) : '';
  document.getElementById('dtAddress').value = l.address || '';
  document.getElementById('dtSource').value = l.source || '';
  document.getElementById('dtEmail').value = l.email || '';
  document.getElementById('dtNote').value = l.note || '';
  document.getElementById('dtBirthday').value = l.birthday || '';
  document.getElementById('dtPersonal').value = l.personalNotes || '';
  document.getElementById('dtCOE').value = l.coeDate || '';
  document.getElementById('dtContractDate').value = l.contractDate || '';
  document.getElementById('dtContractAddr').value = l.contractAddr || l.address || '';

  // Type and stage
  dtSetType(l.type || 'buyer', false);
  dtSetStage(l.stage || 'warm', false);

  // Show contract section if in contract or people
  const stage = l.stage || 'warm';
  document.getElementById('dtContractSection').style.display =
    (stage==='contract'||stage==='people') ? 'block' : 'none';
  if(l.contractDate || l.coeDate) calcMilestones();
  if(l.coeDate) calcFollowUps();



  // Activity history
  const hist = document.getElementById('dtHistory');
  const calls = l.calls || 0;
  const connects = l.connects || 0;
  const texts = l.texts || 0;
  const lastOutcome = l.lastOutcome;
  const lastContact = l.lastContact;

  if (calls === 0 && texts === 0) {
    hist.innerHTML = `<div class="history-item"><div class="history-icon">ğŸ“‹</div><div class="history-txt"><div class="history-outcome">No activity yet</div><div class="history-date">Make your first call to start tracking</div></div></div>`;
  } else {
    let rows = '';
    if (calls > 0) {
      const outcomeLabel = lastOutcome === 'answered' ? 'âœ… Answered' : lastOutcome === 'voicemail' ? 'ğŸ“¬ Voicemail' : lastOutcome === 'noanswer' ? 'ğŸ”‡ No Answer' : 'ğŸ“ Called';
      const dateStr = lastContact ? new Date(lastContact).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}) : 'Unknown date';
      rows += `<div class="history-item"><div class="history-icon">ğŸ“</div><div class="history-txt"><div class="history-outcome">${calls} call${calls!==1?'s':''} Â· ${outcomeLabel}</div><div class="history-date">Last contact: ${dateStr}</div></div></div>`;
    }
    if (connects > 0) rows += `<div class="history-item"><div class="history-icon">âœ…</div><div class="history-txt"><div class="history-outcome">${connects} connect${connects!==1?'s':''}</div><div class="history-date">Answered calls</div></div></div>`;
    if (texts > 0) rows += `<div class="history-item"><div class="history-icon">ğŸ’¬</div><div class="history-txt"><div class="history-outcome">${texts} text${texts!==1?'s':''} sent</div><div class="history-date">Via DialUp</div></div></div>`;
    hist.innerHTML = rows;
  }

  // Show screen
  document.getElementById('screen-main').classList.add('hidden');
  document.getElementById('screen-detail').classList.remove('hidden');
}

function closeDetail() {
  document.getElementById('screen-detail').classList.add('hidden');
  document.getElementById('screen-main').classList.remove('hidden');
  render();
}

function dtSetType(t, update=true) {
  if(update) dtType = t;
  document.getElementById('dtTBuyer').classList.toggle('sel', t==='buyer');
  document.getElementById('dtTSeller').classList.toggle('sel', t==='seller');
}

let dtStage = 'warm';
function dtSetStage(s, update=true) {
  if(update) dtStage = s;
  ['Warm','Hot','Contract','People'].forEach(x =>
    document.getElementById('dtS'+x).classList.toggle('sel', s===x.toLowerCase())
  );
  // Show contract section for contract + people stages
  const showContract = (s==='contract'||s==='people');
  document.getElementById('dtContractSection').style.display = showContract ? 'block' : 'none';

}

/* milestone definitions â€” days from contract acceptance */
const MILESTONES = [
  {id:'escrow',   name:'Escrow Opened',              day:1,  icon:'ğŸ¦'},
  {id:'emd',      name:'EMD Delivered',              day:3,  icon:'ğŸ’°'},
  {id:'discl',    name:'Disclosures Delivered',      day:7,  icon:'ğŸ“„'},
  {id:'inspect',  name:'Inspections Complete',       day:17, icon:'ğŸ”'},
  {id:'negotiat', name:'Negotiations Complete',      day:17, icon:'ğŸ¤'},
  {id:'loan',     name:'Loan Contingency Removed',   day:17, icon:'ğŸ›ï¸'},
  {id:'ctc',      name:'Clear to Close',             day:-5, icon:'âœ…'},
  {id:'closed',   name:'Closed!',                    day:0,  icon:'ğŸ”‘'},
];

function getMilestoneState(){
  const state={};
  MILESTONES.forEach(m=>{
    const cb=document.getElementById('ms_'+m.id);
    const di=document.getElementById('msd_'+m.id);
    if(cb) state[m.id]={done:cb.dataset.done==='1', completedDate:di?di.value:''};
  });
  return state;
}

function calcMilestones(){
  const contractVal = document.getElementById('dtContractDate').value;
  const coeVal = document.getElementById('dtCOE').value;
  const container = document.getElementById('dtMilestones');
  const progress = document.getElementById('dtMilestoneProgress');

  if(!contractVal && !coeVal){ progress.style.display='none'; container.innerHTML=''; return; }

  const now = new Date(); now.setHours(0,0,0,0);
  const contractDate = contractVal ? new Date(contractVal) : null;
  const fmt = d => d.toLocaleDateString('en-US',{month:'short',day:'numeric'});

  // Load saved milestone state for current lead
  const l = leads.find(ld=>ld.id===detailLeadId)||{};
  const saved = l.milestones || {};

  let html = '';
  let doneCount = 0;

  MILESTONES.forEach(m=>{
    const savedState = saved[m.id]||{};
    const isDone = savedState.done || false;
    const completedDate = savedState.completedDate || '';
    if(isDone) doneCount++;

    let dueDate = null;
    const coeDate = coeVal ? new Date(coeVal) : null;
    if(m.day && contractDate){
      if(m.day > 0){
        // Positive days: count forward from contract date
        dueDate = new Date(contractDate.getTime() + m.day*86400000);
      } else if(m.day < 0 && coeDate){
        // Negative days: count back from COE
        dueDate = new Date(coeDate.getTime() + m.day*86400000);
      }
    } else if(m.day === 0 && coeDate){
      // Day 0 = COE date
      dueDate = coeDate;
    }

    // Determine status
    let statusClass = 'upcoming';
    let statusText = dueDate ? 'Due ' + fmt(dueDate) : 'Set COE date';
    if(isDone){
      statusClass='done';
      statusText = completedDate ? 'Completed ' + fmt(new Date(completedDate)) : 'Completed âœ“';
    } else if(dueDate){
      const diff = Math.floor((dueDate-now)/86400000);
      if(diff<0){ statusClass='overdue'; statusText='Overdue by '+Math.abs(diff)+' day'+(Math.abs(diff)!==1?'s':'')+'!'; }
      else if(diff<=2){ statusClass='soon'; statusText='Due in '+diff+' day'+(diff!==1?'s':'')+' â€” '+fmt(dueDate); }
    }

    const checkClass = isDone ? 'done' : statusClass==='overdue' ? 'overdue' : statusClass==='soon' ? 'soon' : '';

    html += `<div class="milestone-item" onclick="toggleMilestone('${m.id}')">
      <div class="milestone-check ${checkClass}" id="ms_${m.id}" data-done="${isDone?'1':'0'}">
        ${isDone?'âœ“':''}
      </div>
      <div class="milestone-info">
        <div class="milestone-name${isDone?' done':''}">${m.icon} ${m.name}</div>
        <div class="milestone-due ${statusClass}">${statusText}</div>
      </div>
      ${isDone?`<input type="date" class="milestone-date-input" id="msd_${m.id}" value="${completedDate}" onclick="event.stopPropagation()" onchange="calcMilestones()" title="Completion date">`:''}
    </div>`;
  });

  container.innerHTML = html;
  progress.style.display = 'block';

  // Update progress bar
  const pct = Math.round((doneCount/MILESTONES.length)*100);
  document.getElementById('dtProgressBar').style.width = pct+'%';
  document.getElementById('dtProgressPct').textContent = doneCount+' of '+MILESTONES.length+' complete';

  // Post-close follow-ups
  calcFollowUps();
}

function toggleMilestone(id){
  const cb = document.getElementById('ms_'+id);
  if(!cb) return;
  const isDone = cb.dataset.done === '1';
  cb.dataset.done = isDone ? '0' : '1';
  // Update lead milestone state immediately
  const l = leads.find(ld=>ld.id===detailLeadId);
  if(l){
    if(!l.milestones) l.milestones={};
    if(!l.milestones[id]) l.milestones[id]={};
    l.milestones[id].done = !isDone;
    if(!isDone) l.milestones[id].completedDate = new Date().toISOString().split('T')[0];
    save();
  }
  calcMilestones();
}

function calcFollowUps() {
  const coeVal = document.getElementById('dtCOE').value;
  if(!coeVal) { document.getElementById('dtFollowUpDates').style.display='none'; return; }
  const coe = new Date(coeVal);
  const fmt = d => d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
  const d7  = new Date(coe.getTime()+7*86400000);
  const d30 = new Date(coe.getTime()+30*86400000);
  const d90 = new Date(coe.getTime()+90*86400000);
  const ann = new Date(coe.getTime()+365*86400000);
  document.getElementById('dtFollowUpList').innerHTML =
    `7-Day Check-In &nbsp;<b>${fmt(d7)}</b><br>`+
    `30-Day Check-In &nbsp;<b>${fmt(d30)}</b><br>`+
    `90-Day Check-In &nbsp;<b>${fmt(d90)}</b><br>`+
    `ğŸ¡ 1-Year Anniversary &nbsp;<b>${fmt(ann)}</b>`;
  document.getElementById('dtFollowUpDates').style.display = 'block';
}

function saveDetail() {
  const l = leads.find(ld => ld.id === detailLeadId);
  if (!l) return;
  const newName = document.getElementById('dtName').value.trim();
  const newPhone = document.getElementById('dtPhone').value.trim();
  if (!newName) { toast('Name is required'); return; }
  if (!newPhone) { toast('Phone is required'); return; }
  l.name = newName;
  l.phone = newPhone.replace(/\D/g,'');
  l.address = document.getElementById('dtAddress').value.trim();
  l.source = document.getElementById('dtSource').value.trim();
  l.email = document.getElementById('dtEmail').value.trim();
  l.note = document.getElementById('dtNote').value.trim();
  l.birthday = document.getElementById('dtBirthday').value;
  l.personalNotes = document.getElementById('dtPersonal').value.trim();
  l.coeDate = document.getElementById('dtCOE').value;
  l.contractDate = document.getElementById('dtContractDate').value;
  l.contractAddr = document.getElementById('dtContractAddr').value.trim();
  // Save milestone completion state
  l.milestones = getMilestoneState();
  l.type = dtType;
  l.stage = dtStage;
  // Priority is derived from stage
  l.priority = (dtStage==='hot') ? 'hot' : 'warm';
  // recalc follow ups if COE set
  if(l.coeDate) {
    const coe = new Date(l.coeDate);
    l.followups = {
      days7: new Date(coe.getTime()+7*86400000).toISOString(),
      days30: new Date(coe.getTime()+30*86400000).toISOString(),
      days90: new Date(coe.getTime()+90*86400000).toISOString(),
      anniversary: new Date(coe.getTime()+365*86400000).toISOString()
    };
  }
  save();
  toast('âœ“ Contact saved!');
  closeDetail();
}

function dtConfirmDelete() {
  const l = leads.find(ld => ld.id === detailLeadId);
  if (!l) return;
  document.getElementById('dtDeleteSub').textContent = 'Remove ' + l.name + ' from DialUp?';
  document.getElementById('dtDeleteDetails').textContent =
    (l.type==='seller'?'ğŸ’° Seller':'ğŸ  Buyer') + ' Â· ' + (l.source||'No source') +
    (l.address ? '\nğŸ“ ' + l.address : '') +
    '\nğŸ“ ' + (l.calls||0) + ' call' + ((l.calls||0)!==1?'s':'') + ' logged';
  document.getElementById('dtDeleteOverlay').classList.remove('hidden');
}

function dtDeleteConfirmed() {
  leads = leads.filter(ld => ld.id !== detailLeadId);
  if (idx >= leads.filter(ld=>!ld.done).length) idx = 0;
  save();
  document.getElementById('dtDeleteOverlay').classList.add('hidden');
  toast('Contact deleted');
  closeDetail();
}


function openPlays(){
  document.getElementById('playsOv').classList.remove('hidden');
}
function closePlays(){
  document.getElementById('playsOv').classList.add('hidden');
}
function togglePlay(n){
  const el=document.getElementById('play'+n);
  if(el.classList.contains('done')){
    el.classList.remove('done');
    el.textContent='âšª';
  }else{
    el.classList.add('done');
    el.textContent='âœ“';
  }
}

function closePCSheet(){
  document.getElementById('pcOverlay').classList.add('hidden');
  // Clear selections
  outcome=null;
  ['answered','noanswer','voicemail'].forEach(o=>{
    const el=document.getElementById('oc-'+o);
    if(el) el.className='oc-btn';
  });
  const notes=document.getElementById('callNotes');
  if(notes) notes.value='';
}
</script>

<!-- â•â•â•â•â•â•â•â•â•â• CONTACT DETAIL SCREEN â•â•â•â•â•â•â•â•â•â• -->
<div class="screen hidden" id="screen-detail">
  <div class="detail-head">
    <div class="back-btn" onclick="closeDetail()">â†</div>
    <h2>CONTACT</h2>
    <button class="detail-save-btn" onclick="saveDetail()">Save</button>
  </div>
  <div class="detail-body">

    <!-- AVATAR + NAME -->
    <div class="contact-avatar" id="dtAvatar">LJ</div>
    <div class="contact-fullname" id="dtFullName">LISA JOHNSON</div>
    <div class="contact-meta" id="dtMeta">Expired Listing Â· Hot</div>

    <!-- CONTRACT SECTION â€” shows when stage = contract or people -->
    <div id="dtContractSection" style="display:none">

      <!-- PROPERTY ADDRESS -->
      <div class="detail-section">
        <div class="detail-section-lbl">ğŸ  Property</div>
        <div class="detail-group">
          <div class="detail-row">
            <div class="detail-row-icon">ğŸ“</div>
            <div class="detail-row-content">
              <div class="detail-row-lbl">Property Address</div>
              <input class="detail-edit-input" id="dtContractAddr" type="text" placeholder="e.g. 1845 W Bullard Ave, Fresno CA">
            </div>
          </div>
        </div>
      </div>

      <!-- CONTRACT DATES -->
      <div class="detail-section">
        <div class="detail-section-lbl">ğŸ“… Transaction Timeline</div>
        <div class="detail-group">
          <div class="contract-dates-row">
            <div class="contract-date-field">
              <div class="contract-date-lbl">Contract Accepted</div>
              <input class="contract-date-input" id="dtContractDate" type="date" onchange="calcMilestones()">
            </div>
            <div class="contract-date-field">
              <div class="contract-date-lbl">Close of Escrow</div>
              <input class="contract-date-input" id="dtCOE" type="date" onchange="calcMilestones()">
            </div>
          </div>

          <!-- MILESTONE PROGRESS BAR -->
          <div class="milestone-progress-wrap" id="dtMilestoneProgress" style="display:none">
            <div class="milestone-progress-label">
              <div class="milestone-progress-title">Transaction Progress</div>
              <div class="milestone-progress-pct" id="dtProgressPct">0 of 8 complete</div>
            </div>
            <div class="milestone-bar-bg">
              <div class="milestone-bar-fill" id="dtProgressBar" style="width:0%"></div>
            </div>
          </div>

          <!-- MILESTONES -->
          <div id="dtMilestones"></div>
        </div>
      </div>

      <!-- POST-CLOSE FOLLOW UPS (shows for My People) -->
      <div id="dtFollowUpDates" style="display:none">
        <div class="detail-section">
          <div class="detail-section-lbl">ğŸ“¬ Post-Close Follow-Ups</div>
          <div class="detail-group">
            <div class="detail-row" style="background:#F0F5FF">
              <div class="detail-row-icon">ğŸ“…</div>
              <div class="detail-row-content">
                <div class="detail-row-lbl">Auto-Scheduled Check-Ins</div>
                <div style="font-size:12px;font-weight:700;color:#1A73E8;line-height:2" id="dtFollowUpList"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- NOTES -->
    <div class="detail-section">
      <div class="detail-section-lbl">Situation / Notes</div>
      <div class="detail-group">
        <div class="detail-row" style="align-items:flex-start">
          <div class="detail-row-icon" style="margin-top:2px">ğŸ“</div>
          <div class="detail-row-content">
            <textarea class="detail-edit-ta" id="dtNote" placeholder="Key situation, motivator, notes..."></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- BASIC INFO -->
    <div class="detail-section">
      <div class="detail-section-lbl">Contact Info</div>
      <div class="detail-group">
        <div class="detail-row">
          <div class="detail-row-icon">ğŸ‘¤</div>
          <div class="detail-row-content">
            <div class="detail-row-lbl">Full Name</div>
            <input class="detail-edit-input" id="dtName" type="text" placeholder="Full name">
          </div>
        </div>
        <div class="detail-row">
          <div class="detail-row-icon">ğŸ“</div>
          <div class="detail-row-content">
            <div class="detail-row-lbl">Phone</div>
            <input class="detail-edit-input" id="dtPhone" type="tel" placeholder="Phone number">
          </div>
        </div>
        <div class="detail-row">
          <div class="detail-row-icon">ğŸ“</div>
          <div class="detail-row-content">
            <div class="detail-row-lbl">Property Address</div>
            <input class="detail-edit-input" id="dtAddress" type="text" placeholder="Address (if known)">
          </div>
        </div>
        <div class="detail-row">
          <div class="detail-row-icon">ğŸ”</div>
          <div class="detail-row-content">
            <div class="detail-row-lbl">Lead Source</div>
            <input class="detail-edit-input" id="dtSource" type="text" placeholder="e.g. Expired, FSBO, Referral...">
          </div>
        </div>
        <div class="detail-row">
          <div class="detail-row-icon">âœ‰ï¸</div>
          <div class="detail-row-content">
            <div class="detail-row-lbl">Email</div>
            <input class="detail-edit-input" id="dtEmail" type="email" placeholder="email@example.com">
          </div>
        </div>
      </div>
    </div>

    <!-- TYPE -->
    <div class="detail-section">
      <div class="detail-section-lbl">Lead Type</div>
      <div class="detail-group">
        <div class="detail-tog-row">
          <div class="detail-tog sel" id="dtTBuyer" onclick="dtSetType('buyer')">ğŸ  Buyer</div>
          <div class="detail-tog" id="dtTSeller" onclick="dtSetType('seller')">ğŸ’° Seller</div>
        </div>
      </div>
    </div>

<!-- STAGE -->
    <div class="detail-section">
      <div class="detail-section-lbl">Stage</div>
      <div class="detail-group">
        <div class="detail-tog-row" style="flex-wrap:wrap;gap:6px">
          <div class="detail-tog" id="dtSWarm" onclick="dtSetStage('warm')" style="flex:1;min-width:80px">â˜€ï¸ Warm</div>
          <div class="detail-tog" id="dtSHot" onclick="dtSetStage('hot')" style="flex:1;min-width:80px">ğŸ”¥ Hot</div>
          <div class="detail-tog" id="dtSContract" onclick="dtSetStage('contract')" style="flex:1;min-width:80px">ğŸ“‹ Contract</div>
          <div class="detail-tog" id="dtSPeople" onclick="dtSetStage('people')" style="flex:1;min-width:80px">ğŸ’› My People</div>
        </div>
      </div>
    </div>

    <!-- PERSONAL -->
    <div class="detail-section">
      <div class="detail-section-lbl">Personal Details</div>
      <div class="detail-group">
        <div class="detail-row">
          <div class="detail-row-icon">ğŸ‚</div>
          <div class="detail-row-content">
            <div class="detail-row-lbl">Birthday</div>
            <input class="detail-edit-input" id="dtBirthday" type="date">
          </div>
        </div>
        <div class="detail-row" style="align-items:flex-start">
          <div class="detail-row-icon" style="margin-top:2px">ğŸ’¬</div>
          <div class="detail-row-content">
            <div class="detail-row-lbl">Personal Notes (spouse, pets, interests...)</div>
            <textarea class="detail-edit-ta" id="dtPersonal" placeholder="e.g. Wife is Sarah. Dog named Ranger. Big Dodgers fan."></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- ACTIVITY -->
    <div class="detail-section">
      <div class="detail-section-lbl">Activity</div>
      <div class="detail-group" id="dtHistory">
        <div class="history-item">
          <div class="history-icon">ğŸ“‹</div>
          <div class="history-txt">
            <div class="history-outcome">No activity yet</div>
            <div class="history-date">Make your first call to start tracking</div>
          </div>
        </div>
      </div>
    </div>

<!-- DELETE â€” iPhone style red button at bottom -->
    <div class="detail-section">
      <button class="delete-contact-btn" onclick="dtConfirmDelete()">Delete Contact</button>
    </div>

  </div>
</div>

<!-- DELETE CONFIRM (from detail view) -->
<div class="overlay hidden" id="dtDeleteOverlay">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sh">
      <div class="sheet-title" style="color:#FF4757">DELETE CONTACT?</div>
      <div class="sheet-sub" id="dtDeleteSub">This cannot be undone.</div>
      <div style="background:#FFF0F0;border:1.5px solid #FFB3B3;border-radius:14px;padding:14px 16px;margin-bottom:18px;font-size:13px;font-weight:700;color:#CC0000;line-height:1.6" id="dtDeleteDetails"></div>
      <button onclick="dtDeleteConfirmed()" style="width:100%;padding:16px;background:#FF4757;border:none;border-radius:15px;font-family:'Bebas Neue',sans-serif;font-size:19px;letter-spacing:2px;color:#fff;cursor:pointer;margin-bottom:10px">YES DELETE</button>
      <button onclick="document.getElementById('dtDeleteOverlay').classList.add('hidden')" style="width:100%;padding:13px;background:transparent;border:1.5px solid #E8E8EC;border-radius:13px;font-family:'Nunito',sans-serif;font-weight:800;font-size:14px;color:#AAA;cursor:pointer">Cancel</button>
    </div>
  </div>
</div>

</body>
</html>
